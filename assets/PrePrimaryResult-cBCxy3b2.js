import{j as e,ai as ge,B as S,aj as Ie,ak as Pe,al as Q,am as U,an as Se,H as m,I as C,ar as Ce,u as ye,A as Te,w as Re,r,x as q,au as ke,E as ve,c as p,jS as B,jT as Ae,jU as Ne,t as K,jV as we,jW as De,F as Ee,p as Ye,G as h,hh as Z,bv as ee,as as se,J as F,a2 as Ue,a3 as Be,bl as Fe,K as Le,a5 as _e,q as te,bB as Ve,aJ as He,a7 as ze,a8 as re,jX as Ge,jY as Me}from"./index-d5YOjbb6.js";import{R as We}from"./ReusableTooltip-SKY-X0Aj.js";import{d as Oe}from"./EventBusy-BCmC0CXH.js";import{C as Xe}from"./CheckCircle-DJwARDWF.js";import{U as $e}from"./Unpublished-OD6eHjAe.js";import{Q as Je}from"./QuestionMark-C2Y4lgD8.js";const Qe=({ItemList:a,HeaderArray:g,clickEdit:l})=>e.jsx("div",{children:e.jsx(ge,{component:S,children:e.jsxs(Ie,{"aria-label":"simple table",sx:{border:t=>`1px solid ${t.palette.grey[300]}`,overflow:"hidden"},children:[e.jsx(Pe,{children:e.jsx(Q,{sx:{background:t=>t.palette.secondary.main,color:t=>t.palette.common.white},children:g.map((t,o)=>e.jsxs(U,{sx:{textTransform:"capitalize",color:c=>c.palette.common.white,py:1,textAlign:o===0?"left":"center",cursor:"default"},children:[e.jsx("b",{children:t.Header}),"                                "]},o))})}),e.jsx(Se,{children:a.map(t=>e.jsxs(Q,{children:[e.jsx(U,{sx:{textTransform:"capitalize",py:.5},children:t.Subject_Name}),e.jsx(U,{sx:{textTransform:"capitalize",py:.5,textAlign:"center"},children:t.EditStatus=="Y"?e.jsx(m,{title:"Edit",children:e.jsx(C,{onClick:()=>l(t.Id,t.Subject_Name,t.IsXseedSubject),sx:{color:"#223354",cursor:"pointer"},children:e.jsx(Ce,{})})}):e.jsx(m,{title:"Exam marks not submitted to the class teacher",children:e.jsx(Oe,{style:{color:"#0f0f0f"}})})})]},t.ItemID))})]})})}),ns=()=>{const a=ye(),g=Te();let{TermId:l,StdDivId:t}=Re();r.useEffect(()=>{l!==void 0&&t!==void 0&&(l=q(l),t=q(t))},[l,t]);const o=Number(localStorage.getItem("localSchoolId")),c=Number(sessionStorage.getItem("AcademicYearId")),[u,L]=r.useState("0"),[y,_]=r.useState(""),[ae,V]=r.useState("");let d=ke(163);const I=Number(sessionStorage.getItem("StandardDivisionId")),[n,H]=r.useState("0"),[le,f]=r.useState(!1),[T,z]=r.useState(""),[G,R]=r.useState(""),P=Number(localStorage.getItem("UserId")),{showAlert:ie,closeAlert:M}=r.useContext(ve);r.useEffect(()=>{var s,i;if(t&&l&&t.length>0&&l.length>0){let b=k.filter(j=>j.Id===t),Y=v.filter(j=>j.Id===l);H(l),L(t),_((s=b[0])==null?void 0:s.Name),V((i=Y[0])==null?void 0:i.Name)}},[t,l]);const ne=[{Id:1,Header:"Subject"},{Id:2,Header:"Edit"}],k=p(s=>s.PrePrimaryResult.PrePrimaryResult).filter(s=>s.Is_PrePrimary=="Y"),v=p(s=>s.PrePrimaryResult.Assessment),A=p(s=>s.PrePrimaryResult.TeacherXseedSubjects),W=A.map(s=>s.EditStatus).every(s=>s==="Y"),x=p(s=>s.PrePrimaryResult.ISlistpublishstatusDetails),N=x.length>0?x[0].IsPublished:"",O=x.length>0?x[0].PublishStatus:"",oe=x.length>0?x[0].StandardDivisionId:"",w=p(s=>s.PrePrimaryResult.Unpublish),D=p(s=>s.PrePrimaryResult.publish),ce={asSchoolId:o,asAcadmicYearId:c,asTeacher_id:0},ue={asAcademicYearId:c,asSchoolId:o},E={asSchoolId:o,asAcadmeicYearId:c,asStdDivId:d=="Y"?Number(u):I,asAssessmentId:Number(n)},de=()=>{const s={asSchoolId:o,asAcademic_Year_Id:c,asStandardDivisionId:d=="Y"?Number(u):I,asAssessmentId:Number(n),asUnPublishReason:T,asInsertedById:P,asUpdatedById:P,IsPublish:!1};a(Me(s))},he=()=>{const s={asSchoolId:o,asAcademic_Year_Id:c,asStandardDivisionId:d=="Y"?Number(u):I,asAssessmentId:Number(n),asUnPublishReason:"",asInsertedById:P,asUpdatedById:P,IsPublish:!0};ie({title:"Please Confirm",message:"Once you publish the result it will be visible to parents/students. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{M()},onConfirm:()=>{a(Ge(s)),M()}})},me=s=>{L(s.Value),_(s.Name)},xe=s=>{H(s)},be=(s,i,b)=>{let Y=d=="N"?sessionStorage.getItem("ClassName"):y==null?void 0:y.split(":")[0],j=d=="N"?sessionStorage.getItem("StandardDivisionId"):u;const J={EditStatusId:N==="Y"?"3P":"2",ClassName:Y,Assesment:ae,SelectTerm:n,SubjectName:i,SubjectId:s,StandardDivisionId:j,selectTeacher:"RP",fromInternal:!0};b==="Y"?g("/RITeSchool/Teacher/AssignPrePrimarySubjectGrades/",{state:J}):b==="N"&&g("/RITeSchool/Teacher/AssignProgressReportSubject/",{state:J})},pe=()=>{f(!0)},X=()=>{let s="";return v.map(i=>{i.Value==n&&(s=i.Name)}),s},[Ze,fe]=r.useState({}),$=()=>{let s="";for(const i of k){const b=d==="Y"?Number(u):I;if(i.Value===String(b)){s=i.Name;break}}return s},je=()=>{T===""?R("Reason for unpublish should not be blank."):(de(),f(!1),R(""))};return r.useEffect(()=>{a(B(E))},[u,n]),r.useEffect(()=>{a(Ae(ue))},[]),r.useEffect(()=>{a(Ne(ce))},[]),r.useEffect(()=>{D!=""&&(K.success(D),a(we()),a(B(E)))},[D]),r.useEffect(()=>{w!=""&&(K.success(w),a(De()),a(B(E)),R(""),z(""))},[w]),e.jsxs(S,{sx:{px:2},children:[e.jsx(Ee,{navLinks:[{title:"Pre-Primary Progress Report Results",path:"/RITeSchool/Teacher/PrePrimaryResult"}],rightActions:e.jsx(e.Fragment,{children:e.jsxs(Ye,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"left",gap:1,sx:{mt:{xs:0,sm:0},flexWrap:{xs:"nowrap",sm:"nowrap"}},children:[e.jsx(h,{item:!0,xs:12,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:e.jsx(Z,{ItemList:v,sx:{width:{xs:"50vw",sm:"13vw"}},onChange:s=>{xe(s.Value),V(s.Name)},defaultValue:n,label:"Assessment",size:"small"})}),e.jsx(h,{item:!0,xs:12,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:d=="Y"&&e.jsx(Z,{ItemList:k,sx:{width:{xs:"70vw",sm:"20vw"}},onChange:s=>{me(s),fe(s.Name)},defaultValue:u,label:"Select Class Teacher",size:"small"})}),e.jsxs(h,{item:!0,xs:12,gap:1,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},children:[n==null?e.jsx("span",{}):e.jsx("span",{children:oe==""||n=="0"?null:e.jsxs(e.Fragment,{children:[e.jsx(m,{title:"Publish",disableInteractive:!0,children:e.jsxs("span",{children:[" ",e.jsx(C,{sx:{color:"white",backgroundColor:ee[500],"&:hover":{backgroundColor:ee[600]}},disabled:!(O=="Y"&&N=="N"&&W),onClick:he,children:e.jsx(Xe,{})})]})}),e.jsx(m,{title:"Unpublish",disableInteractive:!0,children:e.jsxs("span",{children:[" ",e.jsx(C,{sx:{color:"white",backgroundColor:se[500],"&:hover":{backgroundColor:se[600]}},disabled:!(O=="Y"&&N=="Y"&&W),onClick:pe,children:e.jsx($e,{})})]})})]})}),e.jsx(m,{title:"View summarised results of your class for the selected assessment. Assessment result can be publish by clicking on publish button and unpublish by clicking on unpublish button.",children:e.jsx(C,{sx:{color:"white",backgroundColor:F[500],height:"36px !important",":hover":{backgroundColor:F[600]}},children:e.jsx(Je,{})})})]})]})})}),A.length>0?e.jsx(S,{sx:{p:2,background:"white",display:"flex",flexDirection:"column"},children:e.jsx(Qe,{HeaderArray:ne,ItemList:A,clickEdit:be})}):e.jsx("span",{}),e.jsxs(Ue,{open:le,maxWidth:"sm",fullWidth:!0,onClose:()=>{f(!1)},PaperProps:{sx:{borderRadius:"15px"}},children:[e.jsxs(Be,{sx:{bgcolor:"#223354",color:s=>s.palette.common.white},children:[e.jsx(Fe,{onClick:()=>{f(!1)},sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"7px",cursor:"pointer","&:hover":{color:"red"}}}),e.jsx(We,{title:"Enter the reason for assessment unpublish.",children:e.jsx(Le,{sx:{color:"white",borderRadius:"7px",position:"absolute",top:"4px",right:"35px",cursor:"pointer","&:hover":{backgroundColor:F[600]}}})})]}),e.jsx(_e,{children:e.jsxs(S,{sx:{overflowY:"auto",position:"relative",background:"white"},children:[e.jsx("h2",{children:"Enter reason for unpublish"}),e.jsxs(h,{container:!0,spacing:2,alignItems:"center",children:[e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(m,{title:X(),children:e.jsx(te,{fullWidth:!0,InputLabelProps:{shrink:!0},label:e.jsx(e.Fragment,{children:"Assessment"}),sx:{bgcolor:"#F0F0F0","& .MuiInputBase-input":{cursor:"default"}},InputProps:{readOnly:!0},value:X()})})}),e.jsx(h,{item:!0,xs:12,sm:6,children:e.jsx(m,{title:$(),children:e.jsx(te,{fullWidth:!0,InputLabelProps:{shrink:!0},label:e.jsx(e.Fragment,{children:"Class Teacher"}),sx:{bgcolor:"#F0F0F0","& .MuiInputBase-input":{cursor:"default"}},InputProps:{readOnly:!0},value:$()})})}),e.jsxs(h,{item:!0,xs:12,marginTop:1,children:[e.jsx(Ve,{label:"Reason for Unpublish ",value:T,onChange:z,mandatory:!0}),G&&e.jsx(He,{Error:G})]})]})]})}),e.jsxs(ze,{sx:{py:2,px:3},children:[e.jsx(re,{color:"error",onClick:()=>{f(!1)},children:"Close"}),e.jsx(re,{onClick:()=>{je()},color:"error",children:"Unpublish"})]})]})]})};export{ns as default};
