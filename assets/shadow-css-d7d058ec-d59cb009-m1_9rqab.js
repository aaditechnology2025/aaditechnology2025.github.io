var P=function(){for(var r=0,e=0,n=arguments.length;e<n;e++)r+=arguments[e].length;for(var o=Array(r),a=0,e=0;e<n;e++)for(var t=arguments[e],i=0,c=t.length;i<c;i++,a++)o[a]=t[i];return o};/**
 * @license
 * Copyright Google Inc. All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 *
 * This file is a port of shadowCSS from webcomponents.js to TypeScript.
 * https://github.com/webcomponents/webcomponentsjs/blob/4efecd7e0e/src/ShadowCSS/ShadowCSS.js
 * https://github.com/angular/angular/blob/master/packages/compiler/src/shadow_css.ts
 */var N=function(r){var e=[],n=0,o;r=r.replace(/(\[[^\]]*\])/g,function(t,i){var c="__ph-"+n+"__";return e.push(i),n++,c}),o=r.replace(/(:nth-[-\w]+)(\([^)]+\))/g,function(t,i,c){var v="__ph-"+n+"__";return e.push(c),n++,i+v});var a={content:o,placeholders:e};return a},j=function(r,e){return e.replace(/__ph-(\d+)__/g,function(n,o){return r[+o]})},_="-shadowcsshost",b="-shadowcssslotted",E="-shadowcsscontext",W=")(?:\\(((?:\\([^)(]*\\)|[^)(]*)+?)\\))?([^,{]*)",A=new RegExp("("+_+W,"gim"),M=new RegExp("("+E+W,"gim"),D=new RegExp("("+b+W,"gim"),h=_+"-no-combinator",K=/-shadowcsshost-no-combinator([^\s]*)/,U=[/::shadow/g,/::content/g],Y="([>\\s~+[.,{:][\\s\\S]*)?$",H=/-shadowcsshost/gim,$=/:host/gim,q=/::slotted/gim,z=/:host-context/gim,F=/\/\*\s*[\s\S]*?\*\//g,G=function(r){return r.replace(F,"")},I=/\/\*\s*#\s*source(Mapping)?URL=[\s\S]+?\*\//g,J=function(r){return r.match(I)||[]},Q=/(\s*)([^;\{\}]+?)(\s*)((?:{%BLOCK%}?\s*;?)|(?:\s*;))/g,V=/([{}])/g,X="{",Z="}",S="%BLOCK%",y=function(r,e){var n=x(r),o=0;return n.escapedString.replace(Q,function(){for(var a=[],t=0;t<arguments.length;t++)a[t]=arguments[t];var i=a[2],c="",v=a[4],s="";v&&v.startsWith("{"+S)&&(c=n.blocks[o++],v=v.substring(S.length+1),s="{");var l={selector:i,content:c},u=e(l);return""+a[1]+u.selector+a[3]+s+u.content+v})},x=function(r){for(var e=r.split(V),n=[],o=[],a=0,t=[],i=0;i<e.length;i++){var c=e[i];c===Z&&a--,a>0?t.push(c):(t.length>0&&(o.push(t.join("")),n.push(S),t=[]),n.push(c)),c===X&&a++}t.length>0&&(o.push(t.join("")),n.push(S));var v={escapedString:n.join(""),blocks:o};return v},T=function(r){return r=r.replace(z,E).replace($,_).replace(q,b),r},k=function(r,e,n){return r.replace(e,function(){for(var o=[],a=0;a<arguments.length;a++)o[a]=arguments[a];if(o[2]){for(var t=o[2].split(","),i=[],c=0;c<t.length;c++){var v=t[c].trim();if(!v)break;i.push(n(h,v,o[3]))}return i.join(",")}else return h+o[3]})},w=function(r,e,n){return r+e.replace(_,"")+n},rr=function(r){return k(r,A,w)},er=function(r,e,n){return e.indexOf(_)>-1?w(r,e,n):r+e+n+", "+e+" "+r+n},nr=function(r,e){var n="."+e+" > ",o=[];return r=r.replace(D,function(){for(var a=[],t=0;t<arguments.length;t++)a[t]=arguments[t];if(a[2]){for(var i=a[2].trim(),c=a[3],v=n+i+c,s="",l=a[4]-1;l>=0;l--){var u=a[5][l];if(u==="}"||u===",")break;s=u+s}var f=s+v,R=""+s.trimRight()+v.trim();if(f.trim()!==R.trim()){var g=R+", "+f;o.push({orgSelector:f,updatedSelector:g})}return v}else return h+a[3]}),{selectors:o,cssText:r}},tr=function(r){return k(r,M,er)},ar=function(r){return U.reduce(function(e,n){return e.replace(n," ")},r)},or=function(r){var e=/\[/g,n=/\]/g;return r=r.replace(e,"\\[").replace(n,"\\]"),new RegExp("^("+r+")"+Y,"m")},sr=function(r,e){var n=or(e);return!n.test(r)},cr=function(r,e,n){if(H.lastIndex=0,H.test(r)){var o="."+n;return r.replace(K,function(a,t){return t.replace(/([^:]*)(:*)(.*)/,function(i,c,v,s){return c+o+v+s})}).replace(H,o+" ")}return e+" "+r},ir=function(r,e,n){var o=/\[is=([^\]]*)\]/g;e=e.replace(o,function(d){for(var p=[],m=1;m<arguments.length;m++)p[m-1]=arguments[m];return p[0]});var a="."+e,t=function(d){var p=d.trim();if(!p)return"";if(d.indexOf(h)>-1)p=cr(d,e,n);else{var m=d.replace(H,"");if(m.length>0){var C=m.match(/([^:]*)(:*)(.*)/);C&&(p=C[1]+a+C[2]+C[3])}}return p},i=N(r);r=i.content;for(var c="",v=0,s,l=/( |>|\+|~(?!=))\s*/g,u=r.indexOf(h)>-1,f=!u;(s=l.exec(r))!==null;){var R=s[1],g=r.slice(v,s.index).trim();f=f||g.indexOf(h)>-1;var L=f?t(g):g;c+=L+" "+R+" ",v=l.lastIndex}var O=r.substring(v);return f=f||O.indexOf(h)>-1,c+=f?t(O):O,j(i.placeholders,c)},vr=function(r,e,n,o){return r.split(",").map(function(a){return o&&a.indexOf("."+o)>-1?a.trim():sr(a,e)?ir(a,e,n).trim():a.trim()}).join(", ")},B=function(r,e,n,o,a){return y(r,function(t){var i=t.selector,c=t.content;t.selector[0]!=="@"?i=vr(t.selector,e,n,o):(t.selector.startsWith("@media")||t.selector.startsWith("@supports")||t.selector.startsWith("@page")||t.selector.startsWith("@document"))&&(c=B(t.content,e,n,o));var v={selector:i.replace(/\s{2,}/g," ").trim(),content:c};return v})},lr=function(r,e,n,o,a){r=T(r),r=rr(r),r=tr(r);var t=nr(r,o);return r=t.cssText,r=ar(r),e&&(r=B(r,e,n,o)),r=r.replace(/-shadowcsshost-no-combinator/g,"."+n),r=r.replace(/>\s*\*\s+([^{, ]+)/gm," $1 "),{cssText:r.trim(),slottedSelectors:t.selectors}},ur=function(r,e,n){var o=e+"-h",a=e+"-s",t=J(r);r=G(r);var i=[];if(n){var c=function(s){var l="/*!@___"+i.length+"___*/",u="/*!@"+s.selector+"*/";return i.push({placeholder:l,comment:u}),s.selector=l+s.selector,s};r=y(r,function(s){return s.selector[0]!=="@"?c(s):((s.selector.startsWith("@media")||s.selector.startsWith("@supports")||s.selector.startsWith("@page")||s.selector.startsWith("@document"))&&(s.content=y(s.content,c)),s)})}var v=lr(r,e,o,a);return r=P([v.cssText],t).join(`
`),n&&i.forEach(function(s){var l=s.placeholder,u=s.comment;r=r.replace(l,u)}),v.slottedSelectors.forEach(function(s){r=r.replace(s.orgSelector,s.updatedSelector)}),r};export{ur as scopeCss};
