import{j as t,ai as vt,B as x,aj as At,ak as Et,al as fe,am as v,an as Tt,as as A,q as X,bK as Nt,bL as Gt,H as p,I as m,at as Mt,u as Lt,A as Pt,w as Ut,x as Bt,r as s,c as r,k3 as Ht,k4 as Qt,k5 as Ot,k6 as Wt,k7 as $t,k8 as Xt,F as zt,p as Ce,G as P,bR as Vt,aa as _t,bl as ee,du as Ft,J as Se,K as Yt,bv as $,hv as Kt,L as je,bQ as Jt,aJ as I,T as te,ay as Zt,n as es,iU as ts,a2 as be,a3 as Re,a5 as ye,k9 as qe,t as we,ka as ss,ab as is}from"./index-d5YOjbb6.js";import{d as as}from"./AddCircle-8gfCxOOJ.js";import{d as ns}from"./Save-Ckr0NoeK.js";import{d as os}from"./Send-DezDvM8X.js";import{D as rs}from"./index-CUnmri7Y.js";import{R as ls}from"./Requisioneditlist-B57dZprV.js";function ds({ItemList:l,HeaderArray:z,clickDelete:n,onTextChange2:V}){const c=(i,h)=>{const q=i.target.value.replace(/[^0-9.]/g,""),u=l.map(f=>f.ItemID===h.ItemID?{...f,Text3:q}:f);V(u)};return t.jsx(vt,{component:x,children:t.jsxs(At,{"aria-label":"simple table",sx:{border:i=>`1px solid ${i.palette.grey[300]}`},children:[t.jsx(Et,{sx:{overflow:"auto"},children:t.jsx(fe,{sx:{background:i=>i.palette.secondary.main,color:i=>i.palette.common.white},children:z.map((i,h)=>t.jsx(v,{sx:{textTransform:"capitalize",color:q=>q.palette.common.white,py:1.5},children:t.jsx("div",{style:{display:"flex",alignItems:"left",gap:1,justifyContent:i.Header.includes("Remark Template")?"flex-start":"left"},children:t.jsx("b",{children:i.Header})})},h))})}),t.jsx(Tt,{children:l.map(i=>t.jsxs(fe,{children:[t.jsx(v,{sx:{py:1,textTransform:"capitalize",textAlign:"left",color:i.ItemStatus==="Denied"?A[500]:""},children:i.ItemCode}),t.jsx(v,{sx:{py:1,textTransform:"capitalize",textAlign:"left",color:i.ItemStatus==="Denied"?A[500]:""},children:i.ItemName}),t.jsx(v,{sx:{py:1,textTransform:"capitalize",textAlign:"left",color:i.ItemStatus==="Denied"?A[500]:""},children:i.CurrentStock}),t.jsxs(v,{sx:{py:1,textTransform:"capitalize",textAlign:"left",color:i.ItemStatus==="Denied"?A[500]:""},children:[t.jsx(X,{label:t.jsx("span",{children:t.jsx("span",{style:{color:"red"},children:"*"})}),size:"small",id:"outlined-basic",value:i.Text3,variant:"outlined",onChange:h=>c(h,i),sx:{width:"100px",mr:2,mb:1}}),t.jsx(Nt,{value:i.UOMUnit,sx:{width:"100px",height:"37px"},disabled:!0,children:t.jsx(Gt,{value:i.UOMUnit,children:i.UOMUnit})})]}),t.jsx(v,{sx:{textTransform:"capitalize",py:1,textAlign:"left"},align:"left",children:t.jsx(p,{title:"Delete",children:t.jsx(m,{sx:{color:i.ItemStatus==="Denied"?A[500]:"#223354","&:hover":{cursor:"pointer",color:"red",backgroundColor:A[100]}},onClick:()=>n(i.ItemID),children:t.jsx(Mt,{})})})})]},i.ItemID))})]})})}const Cs=()=>{const l=Lt(),z=Pt();let{asRequisitionId:n}=Ut();n=Bt(n);const V=Number(sessionStorage.getItem("AcademicYearId")),c=Number(localStorage.getItem("localSchoolId")),i=Number(localStorage.getItem("UserId")),[h,q]=s.useState(),[u,f]=s.useState([]),[cs,ke]=s.useState([]),[us,se]=s.useState(0),[E,ie]=s.useState(""),[_,De]=s.useState("");s.useState();const[T,C]=s.useState(""),[N,G]=s.useState(""),[ve,S]=s.useState(""),[Ae,j]=s.useState(""),[Ee,b]=s.useState(""),[ae,Te]=s.useState(""),[d,w]=s.useState([]),[Ne,M]=s.useState(""),[Ge,k]=s.useState(""),[Me,ne]=s.useState(""),[Le,R]=s.useState(""),[U,oe]=s.useState(),[Pe,F]=s.useState(!1),[Ue,Be]=s.useState(""),[Y,He]=s.useState(""),[Qe,re]=s.useState(""),[K,Oe]=s.useState(!1),[We,le]=s.useState(!1),[y,$e]=s.useState(20),[B,de]=s.useState(1),Xe=[20,50,100,200],H=r(e=>e.SliceAddRequisition.ISGetItemCategory),Q=r(e=>e.SliceAddRequisition.IsGetAddItemList),J=r(e=>e.SliceAddRequisition.ISSaveRequisition),O=r(e=>e.SliceAddRequisition.ISlistGetRequisitionName),ze=(O==null?void 0:O.length)>0?O.map(e=>e.RequisitionID):0,W=r(e=>e.SliceAddRequisition.ISGetNewRequisitionValidateItemQuantity),Ve=r(e=>e.SliceAddRequisition.ISCanCreateGenralRequisition),_e=r(e=>e.SliceAddRequisition.ISCanSendRequisition),L=r(e=>e.SliceAddRequisition.ISCountRequisitionList),g=r(e=>e.SliceAddRequisition.ISGetRequisitionDetails),ce=r(e=>e.SliceAddRequisition.ISGetRequisitionDetails1),ue=r(e=>e.SliceAddRequisition.ISGetRequisitionDetails2),Fe=ue.length>0?ue[0].Is_General:null,Ye=r(e=>e.SliceAddRequisition.Loading),Ke=r(e=>e.SliceAddRequisition.ISGetItemImage.ImageUrls);[...new Set(J.map(e=>e.ItemName))];const Je=g.map(e=>e.Text3),Ze={asSchoolId:c},et={asSchoolId:c,asName:E,asItemCategoryId:h,asStartIndex:(B-1)*y,asEndIndex:B*y,asSortExp:"ORDER BY ItemName"},tt={asSchoolId:c,asItemId:Number(ae)},st={asSchoolId:c,asUserId:i},it={asSchoolId:c,asUserId:i,asAcademicYearId:V},at=[{Id:1,Header:"Item Code"},{Id:2,Header:"Item Name"},{Id:3,Header:"Current Stock"},{Id:4,Header:"Item Quantity"},{Id:8,Header:"Delete"}],nt=[{Id:1,Header:"Status Changed by"},{Id:2,Header:"Request Status"},{Id:3,Header:"Date"}];s.useEffect(()=>{const a=(()=>{let o="<RequisitionItems>";return d.forEach(D=>{o+=`
                    <RequisitionItems 
                        ItemID="${D.ItemID}" 
                        UOM="0" 
                        ItemQty="${D.Text3}" 
                        ItemOrgQty="${D.Text3}" 
                    />
                `}),o+="</RequisitionItems>",o})();He(a)},[d]),console.log(Y,"setXmlString1"),s.useEffect(()=>{const a=(()=>{let o='<ArrayOfRequisitionData xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">';return d.forEach(D=>{o=o+"<RequisitionData><ItemId>"+D.ItemID+"</ItemId><Quantity>"+D.Text3+"</Quantity></RequisitionData>"}),o=o+"</ArrayOfRequisitionData>",o})();Be(a)},[d]),console.log();const ot={asSchoolId:c,asQuantityDetailsXML:Ue},rt={asSchoolId:c,asRequisitionId:Number(n),asMode:"Edit"};s.useEffect(()=>{l(Ht(rt))},[n]);const xe=(()=>{let e=[];return d.forEach(a=>{e.push(a.ItemName)}),e.join(", ")})(),lt=()=>{let e=!1,a=[];const o={asSchoolId:c,asRequisitionId:Number(n)?Number(n):0,asUserId:i,asRequisitionName:T.trim(),asRequisitionDesc:N.trim(),asAction:"save",asRequisitionItemDetailsXml:Y,asIsGeneral:K};U==null||U==""?(R(`Quantity should be greater than zero for item ${xe}.`),e=!0):R(""),T.trim()===""?(S("Requisition name should not be blank."),e=!0):S(""),N.trim()===""?(j("Requisition description should not be blank."),e=!0):j(""),a.length>0?(b(a.join(`
`)),e=!0):b(""),W.Codes!=null?(k(`Item quantity should not be greater than current stock for item with code : ${W.Codes}`),e=!0):k(""),e||(l(qe(o)),we.success("Requisition is saved (draft) successfully."))},dt=()=>{let e=!1,a=[];const o={asSchoolId:c,asRequisitionId:Number(n)?Number(n):ze.toString(),asUserId:i,asRequisitionName:T,asRequisitionDesc:N,asAction:"send",asRequisitionItemDetailsXml:Y,asIsGeneral:K};U==null||U==""?(R(`Quantity should be greater than zero for item ${xe}.`),e=!0):R(""),T===""?(S("Requisition name should not be blank."),e=!0):S(""),N===""?(j("Requisition description should not be blank."),e=!0):j(""),a.length>0?(b(a.join(`
`)),e=!0):b(""),W.Codes!==null?(k(`Item quantity should not be greater than current stock for item with code : ${W.Codes}`),e=!0):k(""),_e==!1?(ne("You can not send requisition since approval level is not configured or user is not available in approval designation."),e=!0):ne(""),e||(l(qe(o)),we.success("Requisition is sent successfully."),z("/RITeSchool/Teacher/Requisition",{state:{fromInternal:!0}}),f([]),w([]),S(""),j(""),b(""),se(0),C(""),G(""),M(""),k(""),R(""))},me=()=>{E==""?(re("Item Code / Name should not be blank."),F(!1)):(l(ss(et)),F(!0),le(u.length===0),re(""))};s.useEffect(()=>{E!==""&&Pe==!0&&f(Q)},[Q]);const ct=e=>{ie(e)},ut=()=>{ie("")},[xt,he]=s.useState(!1),mt=()=>{he(!0)},ge=()=>{he(!1)},ht=e=>{Oe(e.target.checked)},gt=[{id:"itemCode",label:"Item Code",selector:e=>e.ItemCode,renderCell:e=>e.ItemCode},{id:"itemName",label:"Item Name",selector:e=>e.ItemName,renderCell:e=>e.ItemName},{id:"currentStock",label:"Current Stock",selector:e=>e.CurrentStock,renderCell:e=>e.CurrentStock},{id:"category",label:"Category",selector:e=>e.ItemCategoryName,renderCell:e=>e.ItemCategoryName},{id:"ImageCount",label:"Item Image",selector:e=>e.ImageCount,renderCell:e=>e.ImageCount>0?t.jsx(p,{title:"View",children:t.jsx(m,{onClick:()=>Te(e.ItemID),sx:{padding:"3px 8px",margin:"0px 15px"},children:t.jsx(is,{onClick:mt,sx:{color:"#223354",display:"flex",alignItems:"Center"}})})}):t.jsx("div",{children:" "})},{id:"Add Item",label:"Add Item",renderCell:e=>t.jsx(p,{title:"Add",children:t.jsx(m,{onClick:()=>bt(e.ItemID),sx:{padding:"3px 8px",margin:"0px 12px"},children:t.jsx(as,{sx:{color:"#223354",display:"flex",alignItems:"Center"}})})})}],It=e=>{q(e)},pt=()=>{f([]),S(""),j(""),b(""),se(0),C(""),G(""),M(""),k(""),R(""),F(!1),le(!1);const e=g[0];e&&(C(e.RequisitionName),G(e.RequisitionDescription))};s.useEffect(()=>{ke(J)},[J]);const ft=e=>{w(e),oe(e.map(a=>a.Text3))},Ct=e=>{e.target.value.length<=40&&C(e.target.value)},St=e=>{e.target.value.length<=500&&G(e.target.value)};s.useEffect(()=>{H.length>0&&q(H[0].Value)},[H]),s.useEffect(()=>{l(Qt(Ze))},[]),s.useEffect(()=>{d.length>0&&l(Ot(ot))},[d]),s.useEffect(()=>{l(Wt(st))},[]),s.useEffect(()=>{l($t(it))},[]),s.useEffect(()=>{l(Xt(tt))},[ae]);const jt=e=>{w(a=>a.filter(o=>o.ItemID!==e)),M(""),S(""),j(""),b(""),R("")},bt=e=>{d.some(a=>a.ItemID===e)?M("Item already exists."):(De(e),M(""))};s.useEffect(()=>{if(_){const e=Q.find(a=>a.ItemID===_);e&&w(a=>a.some(o=>o.ItemID===e.ItemID)?a:[...a,e])}},[_,Q]),s.useEffect(()=>{if(g!=""&&n){const e=g[0];e&&(C(e.RequisitionName),G(e.RequisitionDescription))}},[g,n]),s.useEffect(()=>{n&&w(g)},[n,g]),s.useEffect(()=>{n&&oe(Je)},[n,g]),s.useEffect(()=>{n==null&&(w([]),C(""),C(""))},[n]);const Rt=e=>{de(e)},yt=e=>{$e(parseInt(e.target.value,10)),de(1)},qt=(B-1)*y+1,wt=Math.min(B*y,L.TotalCount),kt=Math.ceil(L.TotalCount/y),[Z,Ie]=s.useState(null),Dt=e=>{Ie(e)},pe=()=>{Ie(null)};return t.jsxs(x,{sx:{px:2},children:[t.jsx(zt,{navLinks:[{title:"Requisition",path:"/RITeSchool/Teacher/Requisition"},{title:"Requisition Details",path:"/RITeSchool/Teacher/AddRequisition"}],rightActions:t.jsxs(Ce,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"left",gap:1,sx:{mt:{xs:0,sm:0},flexWrap:{xs:"nowrap",sm:"nowrap"}},children:[t.jsx(P,{item:!0,xs:12,sm:6,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},children:t.jsx(Vt,{sx:{minWidth:{xs:"40vw",sm:"14vw",md:"14vw",lg:"14vw"},bgcolor:"#F0F0F0","& .MuiInputBase-input":{cursor:"default"}},ItemList:H,onChange:It,label:"Category",defaultValue:h,IsReadOnly:u.length>0,size:"small"})}),t.jsx(P,{item:!0,xs:12,sm:6,gap:1,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},children:t.jsx(X,{sx:{minWidth:{xs:"40vw",sm:"14vw",md:"14vw",lg:"14vw"},bgcolor:"#F0F0F0","& .MuiInputBase-input":{cursor:"default"}},fullWidth:!0,label:t.jsxs("span",{children:["Item Code/Name",t.jsx("span",{style:{color:"red"},children:"*"})]}),value:E,variant:"outlined",size:"small",onKeyDown:e=>{(e.key==="Enter"||e.key==="Tab")&&me()},onChange:e=>ct(e.target.value),InputProps:{readOnly:u.length>0,endAdornment:t.jsx(_t,{position:"end",children:E&&t.jsx(m,{onClick:ut,edge:"end",disabled:u.length>0,children:t.jsx(ee,{})})})}})}),t.jsxs(Ce,{direction:{xs:"row",sm:"row"},spacing:1,alignItems:"center",justifyContent:"flex-start",sx:{width:"100%",flexWrap:{xs:"wrap",sm:"nowrap"}},children:[t.jsx(p,{title:"Search",children:t.jsx(m,{onClick:me,disabled:u.length>0,sx:{background:e=>e.palette.primary.main,color:"white","&:hover":{color:"white",backgroundColor:e=>e.palette.primary.dark},"&.Mui-disabled":{color:e=>e.palette.action.disabled}},children:t.jsx(Ft,{})})}),t.jsx(p,{title:"Here you can create/ modify/ view/ approve/ denied requisition.",children:t.jsx(m,{sx:{color:"white",backgroundColor:Se[500],":hover":{backgroundColor:Se[600]}},children:t.jsx(Yt,{})})}),t.jsx(p,{title:"Reset",children:u.length>0&&t.jsx(m,{onClick:pt,sx:{color:"white",backgroundColor:$[500],"&:hover":{backgroundColor:$[600]}},children:t.jsx(Kt,{})})}),d.length>0&&t.jsx(p,{title:"Save",children:t.jsx(m,{onClick:lt,sx:{color:"white",backgroundColor:je[500],":hover":{backgroundColor:je[600]}},children:t.jsx(ns,{})})}),d.length>0&&t.jsx(p,{title:"Send Requisition",children:t.jsx(m,{onClick:dt,sx:{color:"white",backgroundColor:$[500],"&:hover":{backgroundColor:$[600]}},children:t.jsx(os,{})})})]})]})}),t.jsxs(x,{display:"flex",alignItems:"center",children:[t.jsx(P,{item:!0,xs:12,sm:3,children:t.jsx(X,{sx:{minWidth:{xs:"40vw",sm:"15vw"},"& .MuiInputBase-root":{height:"35px",color:"black"},"& .MuiInputLabel-root":{top:"-6px",color:"black"}},label:"Is General Requisition ? :",InputProps:{readOnly:!0,disabled:!0},variant:"outlined"})}),Ve=="Y"||Fe==!0?t.jsx(Jt,{checked:K,onChange:ht,sx:{mr:1,"& .MuiSvgIcon-root":{fontSize:30}}}):t.jsx("span",{children:" "})]}),t.jsx("br",{}),t.jsx(I,{Error:ve}),t.jsx(I,{Error:Ae}),t.jsx(I,{Error:Ee}),t.jsx(I,{Error:Le}),t.jsx(I,{Error:Ne}),t.jsx(I,{Error:Ge}),t.jsx(I,{Error:Me}),t.jsx(I,{Error:Qe}),u.length>0?t.jsx(x,{sx:{flex:1,textAlign:"center",background:"white",p:.5},children:t.jsxs(te,{variant:"subtitle1",sx:{margin:"16px 0",textAlign:"center"},children:[t.jsxs(x,{component:"span",fontWeight:"fontWeightBold",children:[qt," to ",wt]})," ","out of"," ",t.jsx(x,{component:"span",fontWeight:"fontWeightBold",children:L.TotalCount})," ",L.TotalCount===1?"record":"records"]})}):t.jsx("span",{}),u.length>0?t.jsxs(x,{mb:0,sx:{px:2,pb:.5,background:"white"},children:[t.jsx(rs,{columns:gt,data:u,isPagination:!1}),L.TotalCount>y?t.jsx(Zt,{rowsPerPage:y,ChangeRowsPerPage:yt,rowsPerPageOptions:Xe,PageChange:Rt,pagecount:kt}):t.jsx("span",{})]}):We&&t.jsx(te,{variant:"body1",sx:{textAlign:"center",marginTop:4,backgroundColor:"#324b84",padding:1,borderRadius:2,color:"white"},children:t.jsx("b",{children:"No record found."})}),d.length>0?t.jsxs(x,{mb:1,sx:{p:2,background:"white"},children:[Ye&&t.jsx(es,{}),t.jsx(ds,{ItemList:d,HeaderArray:at,clickDelete:jt,onTextChange2:ft}),t.jsx("br",{}),t.jsx(P,{item:!0,xs:12,children:t.jsx(X,{label:t.jsxs("span",{children:["Requisition Name ",t.jsx("span",{style:{color:"red"},children:"*"})]}),value:T,onChange:Ct,fullWidth:!0})}),t.jsx("br",{}),t.jsx(P,{item:!0,xs:12,children:t.jsx(ts,{label:t.jsxs("span",{children:["Requisition Description ",t.jsx("span",{style:{color:"red"},children:"*"})]}),multiline:!0,value:N,onChange:St,fullWidth:!0})})]}):null,ce!=""&&n!==void 0?t.jsx(x,{mb:1,sx:{p:2,background:"white"},children:t.jsx(ls,{ItemList:ce,HeaderArray:nt})}):t.jsx("span",{}),t.jsxs(x,{sx:{display:"flex",justifyContent:"flex-end",mt:2,minHeight:"auto",minWidth:"300px"},children:[t.jsxs(be,{open:xt,onClose:ge,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{borderRadius:"15px"}},children:[t.jsx(Re,{sx:{bgcolor:"#223354",position:"relative"},children:t.jsx(ee,{onClick:ge,sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"8px",cursor:"pointer","&:hover":{color:"red"}}})}),t.jsx(te,{variant:"h3",sx:{pt:1,pl:2},children:"Item Images"}),t.jsx(ye,{children:Ke.map((e,a)=>t.jsx("img",{src:e.ImageUrl,alt:`Image ${a+1}`,style:{width:"100px",margin:"5px",cursor:"pointer"},onClick:()=>Dt(e.ImageUrl)},a))})]}),t.jsxs(be,{open:!!Z,onClose:pe,fullWidth:!0,maxWidth:"sm",PaperProps:{sx:{borderRadius:"15px"}},children:[t.jsx(Re,{sx:{bgcolor:"#223354",position:"relative"},children:t.jsx(ee,{onClick:pe,sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"8px",cursor:"pointer","&:hover":{color:"red"}}})}),t.jsx(ye,{children:Z&&t.jsx("img",{src:Z,alt:"Enlarged view",style:{width:"100%",height:"auto",paddingTop:"7px"}})})]})]})]})};export{Cs as default};
