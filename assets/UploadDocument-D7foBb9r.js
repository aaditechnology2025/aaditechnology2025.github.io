import{j as e,de as ae,S as le,r as a,G as g,H as X,a8 as G,p as L,bw as ie,B as T,I as V,as as ce,at as de,ab as ue,T as R,fL as me,bx as pe,E as he,c as h,hl as ge,hm as B,u as xe,hn as fe,t as z,ho as Ie,hp as De,hq as Se,a2 as ye,a3 as be,J as je,bl as ve,a5 as Ce,q as W,a7 as Fe,L as Ne,hr as we,hs as Ae}from"./index-d5YOjbb6.js";import{d as Ue}from"./CloudUpload-DJN1zp2n.js";import{E as ke}from"./Errormessage-RPRSgLGN.js";import{U as Ee}from"./UploadDocList-BICUPjQ0.js";import{Q as Pe}from"./QuestionMark-C2Y4lgD8.js";const Le=s=>{if(typeof s!="string")return null;const[l]=s.split(" ");if(!l)return null;const[n,o,m]=l.split("-");return!n||!o||!m?null:new Date(`${m}-${o}-${n}`)},Be=s=>{if(!(s instanceof Date)||isNaN(s.getTime()))return"";const l=String(s.getDate()).padStart(2,"0"),n=String(s.getMonth()+1).padStart(2,"0"),o=s.getFullYear();return`${l}-${n}-${o}`},$e=({DateValue:s,onDateChange:l,label:n,size:o,fullWidth:m=!0,maxDate:x=!1,minDate:i=!1,disabled:j=!1})=>{const f=s?Le(s):null,d=p=>{const I=p?Be(p):"";l(I)};return e.jsx(e.Fragment,{children:e.jsx(ae,{disabled:j,value:f,onChange:d,format:"dd MMM yyyy",label:n?e.jsxs(e.Fragment,{children:[n," ",n&&e.jsx("span",{style:{color:"red"},children:"*"})]}):n===""?"":"Select Date",views:["year","month","day"],maxDate:x?new Date:void 0,minDate:i?new Date:void 0,slotProps:{textField:{variant:"outlined",fullWidth:m,size:o||"medium",inputProps:{readOnly:!0}}}})})},Ge=({ValidFileTypes:s,MaxfileSize:l,ChangeFile:n,errorMessage:o="",clickDelete:m=void 0,clickFileName:x=void 0,FileName:i="",FilePath:j="",width:f="300px",viewIcon:d=!1,deleteIcon:p=!1,FileLabel:I="",isMandatory:D=!0,height:N="auto"})=>{le();const S=a.useRef(null),[w,v]=a.useState("");a.useEffect(()=>{i==""&&(S.current.value=null)},[i]);const C=async y=>{const u=y.target.files;let F="";for(let r=0;r<u.length;r++){const b=me(u[r],s,l);b==null?(F=await pe(u[r]),v(""),o="",n({Name:u[r].name,Value:F.slice(F.indexOf(",")+1),FileExtension:u[r].name.split(".").at(-1),ErrorMsg:""})):(v(b),o="",n({Name:"",Value:"",FileExtension:"",ErrorMsg:b}),S.current.value=null)}};return e.jsxs(g,{container:!0,children:[e.jsxs(g,{item:!0,xs:12,sx:{display:"flex",alignItems:w?"flex-start":"center",justifyContent:"center",height:"auto"},children:[e.jsx(X,{title:"Supports only "+s.join(", ")+" files types up to "+(l/1e6).toString()+" MB.",children:e.jsxs(G,{sx:{width:f,height:N,border:y=>`1px dashed ${y.colors.primary.main}`,gap:1,position:"relative",display:"flex",alignItems:"center",justifyContent:"space-between"},color:"primary",children:[e.jsxs(L,{direction:"row",alignItems:"center",gap:1,sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[i?e.jsx(ie,{}):e.jsx(Ue,{}),i==""?I||" No file selected":i,D&&e.jsx("span",{style:{color:"red"},children:"*"}),e.jsx(T,{sx:{textAlign:"center"},children:e.jsx("input",{ref:S,type:"file",accept:".bmp, .doc, .docx, .jpg, .jpeg, .pdf, .xls, .xlsx",onChange:C,style:{opacity:0,position:"absolute",top:0,left:0,right:0,bottom:0,cursor:"pointer"}})})]}),e.jsx(L,{direction:"row",alignItems:"center",justifyContent:"center",gap:1})]})}),j!=""&&e.jsxs(L,{direction:"row",spacing:-1,children:[p&&e.jsx(V,{sx:{marginLeft:1,"&:hover":{color:"red",backgroundColor:ce[100]}},onClick:m,children:e.jsx(de,{style:{fontSize:30}})}),d&&e.jsx(V,{color:"primary",onClick:x,children:e.jsx(ue,{style:{fontSize:30}})})]})]}),o&&e.jsx(g,{item:!0,xs:12,sx:{display:"flex",alignItems:"left",justifyContent:"left",pt:2},children:e.jsx(R,{children:o&&e.jsx(ke,{Error:o})})})]})},He=({Id:s,yearId:l,ReportingUserId:n,open:o,handleClose:m,RefreshList:x,saveButton:i})=>{const{showAlert:j,closeAlert:f}=a.useContext(he),[d,p]=a.useState(""),[I,D]=a.useState("");a.useState("");const[N,S]=a.useState(""),[w,v]=a.useState(!1),C=Number(localStorage.getItem("localSchoolId")),y=localStorage.getItem("FolderName");sessionStorage.getItem("FinancialYearId"),Number(sessionStorage.getItem("AcademicYearId"));const u=Number(localStorage.getItem("UserId")),F=sessionStorage.getItem("Id"),r=h(t=>t.PerformanceGradeAssignment.ISUserInvestmentMethodDetails),b=h(t=>t.PerformanceGradeAssignment.ISGetAllDocumentsList),A=localStorage.getItem("SchoolId"),U=sessionStorage.getItem("FinancialYearId"),_={asSchoolId:Number(A),asFinancialYearId:Number(U),asUserId:Number(s),asDocumentId:null,asDocumentTypeId:8},k={asSchoolId:Number(A),asUserId:Number(s),asFinancialYearId:1,asDocumentTypeId:8,asAcademicYearId:Number(l),asDocumentId:0,asReportingUserId:Number(n),asLoginUserId:Number(sessionStorage.getItem("Id"))},J={asSchoolId:Number(A),asAcademicYearId:Number(l),asFinancialYearId:Number(U),asDocumentId:0,asFileName:d==""?null:d,asUserId:Number(s),asInsertedById:u,asDocumnetTypeId:8,asReportingUserId:Number(n),asSaveFeature:"Performance Evaluation",asFolderName:y.toString(),asBase64String:N==""?null:N};a.useEffect(()=>{c(ge(_)),c(B(k)),D("")},[o]),a.useState("");const c=xe(),q=[{Id:1,Header:"File Name"},{Id:2,Header:"View",align:"center"},{Id:3,Header:"Delete",align:"center"}],O=localStorage.getItem("SiteURL");O.split("/")[O.split("/").length-1];const Q=["BMP","DOC","DOCX","PNG","JPG","JPEG","PDF","XLS","XLSX"],K=5e6;h(t=>t.AddInvestmentDetailsDoc.ISCheckPublishUnpublishDocument);const E=h(t=>t.AddInvestmentDetailsDoc.ISSaveInvestmentDocument),M=h(t=>t.AddInvestmentDetailsDoc.ISGetAllDocumentsList);h(t=>t.AddInvestmentDetailsDoc.ISGetInvestmentDocumentFile);const Y=h(t=>t.AddInvestmentDetailsDoc.ISDeleteInvestmentDocument),Z={asSchoolId:C,asFinancialYearId:1,asUserId:u},ee={asSchoolId:C,asId:Number(s)};a.useEffect(()=>{c(fe(Z))},[]);const te=()=>{let t=!1;!d||d===""?(D("Select file to upload."),t=!0):D(""),t||(c(we(J)),$())};a.useEffect(()=>{E!=""&&(z.success(E),c(Ie()),v(!0),c(B(k)),x())},[E]),a.useEffect(()=>{c(De(ee))},[]);const se=t=>{p(t.Name),S(t.Value),D(t.ErrorMsg)},$=()=>{p(""),S("")},ne=t=>{const re={asSchoolId:C,asFinancialYearId:Number(U),asUpdatedById:u,asDocumentId:Number(t),asDocumnetTypeId:8};j({title:"Please Confirm",message:"Are you sure you want to delete this record?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{f()},onConfirm:()=>{c(Ae(re)),f()}})};a.useEffect(()=>{Y!==""&&(z.success("Document deleted successfully."),c(Se()),v(!0),c(B(k)),x())},[Y]);const oe=t=>{window.open(localStorage.getItem("SiteURL")+"/RITESCHOOL/DOWNLOADS/Performance Evaluation/"+t)},P=()=>{$(),m(w)},H=()=>{let t=!0;return n===F&&i==="2"&&(t=!1),t};return e.jsxs(ye,{open:o,maxWidth:"md",fullWidth:!0,onClose:P,PaperProps:{sx:{borderRadius:"15px"}},children:[e.jsxs(be,{sx:{bgcolor:"#223354"},children:[e.jsx(X,{title:"Upload / delete document(s).",children:e.jsx(Pe,{sx:{color:"white",borderRadius:"10px",position:"absolute",top:"4px",right:"35px",cursor:"pointer","&:hover":{backgroundColor:je[600]}}})}),e.jsx(ve,{onClick:P,sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"8px",cursor:"pointer","&:hover":{color:"red"}}})]}),e.jsxs(Ce,{children:[e.jsxs(T,{children:[e.jsx(R,{variant:"h2",sx:{pt:2,pl:1},children:"Documents"}),e.jsxs(g,{container:!0,spacing:2,mt:.5,children:[e.jsx(g,{item:!0,xs:12,sm:4,md:4,lg:4,children:e.jsx(W,{fullWidth:!0,label:e.jsx(e.Fragment,{children:"User Name"}),InputLabelProps:{shrink:!0},sx:{width:"100%",bgcolor:"#F0F0F0","& .MuiInputBase-input":{cursor:"default"}},value:Object.keys(r).length>0?r==null?void 0:r.UserName:"",size:"medium",InputProps:{readOnly:!0}})}),e.jsx(g,{item:!0,xs:12,sm:4,md:4,lg:4,children:e.jsx(W,{fullWidth:!0,label:e.jsx(e.Fragment,{children:"Document Name"}),InputLabelProps:{shrink:!0},sx:{width:"100%",bgcolor:"#F0F0F0","& .MuiInputBase-input":{cursor:"default"}},value:Object.keys(r).length>0?r==null?void 0:r.DocumentName:"",size:"medium",InputProps:{readOnly:!0}})}),e.jsx(g,{item:!0,xs:12,sm:4,md:4,lg:4,children:e.jsx(Ge,{ValidFileTypes:Q,MaxfileSize:K,FileName:d,ChangeFile:se,FileLabel:"Attachment",width:"100%",height:"52px",FilePath:M.length>0?M.FileName:"",errorMessage:I,isMandatory:!0})})]})]}),e.jsx(T,{sx:{backgroundColor:"white",mt:2},children:b.length>0?e.jsx(Ee,{HeaderArray:q,ItemList:b,clickDelete:ne,clickView:oe,isDeletePermission:H()}):e.jsx(R,{variant:"h6",align:"center",color:"blue",sx:{textAlign:"center",marginTop:1,backgroundColor:"#324b84",padding:1,borderRadius:2,color:"white"},children:"No record found."})}),e.jsxs(Fe,{sx:{py:2,px:3},children:[e.jsx(G,{color:"error",onClick:P,children:"Cancel"}),e.jsx(G,{onClick:te,sx:{color:"green","&:hover":{color:"green",backgroundColor:Ne[100]}},disabled:H(),children:"Save"})]})]})]})};export{$e as D,He as U};
