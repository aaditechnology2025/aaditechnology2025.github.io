import{h as ve,bt as ht,r as s,j as e,B as a,T as m,bv as N,am as u,D as Se,ai as gt,aj as St,ak as ft,al as fe,an as jt,S as bt,A as Ct,t as ee,E as It,ae as O,c as te,w as Tt,x as yt,ag as Rt,u as vt,X as Dt,e8 as Mt,aB as kt,F as Nt,H as M,I as se,J as U,K as oe,L as G,c8 as At,M as wt,N as Ft,O as Et,Q as Bt,R as ne,G as i,q as k,ce as re,bQ as ae,a8 as g,b9 as Pt,aI as Wt,a2 as je,a3 as be,bl as Ce,a5 as Ie,a7 as Te,e7 as Lt}from"./index-d5YOjbb6.js";import{d as Ot}from"./Info-A-drYdpS.js";import{d as Ut}from"./Send-DezDvM8X.js";import{u as Gt}from"./formik.esm-DT8TU67t.js";import{T as Ht}from"./TimepickerTwofields-BVuL9CW4.js";import{A as _t}from"./AddReciepents-D_RJXJSl.js";import{E as ye}from"./Errormessage-RPRSgLGN.js";import{C as Vt}from"./CardStyle-B9qFmFtz.js";import{d as $t}from"./ArrowCircleDown-D40CfZ6q.js";import{d as Yt}from"./ArrowCircleUp-BmCXupv-.js";import{C as zt}from"./Card-BrM9kpJu.js";import{C as Qt}from"./CardContent-CKN_wOTn.js";import{R as Re}from"./Radio-CCPcjMAp.js";import"./GroupAdd-CeGlO5QJ.js";import"./Square-gela0mjc.js";import"./Search-Cux6sdg-.js";import"./ListSelect-XR4RTIQy.js";import"./CheckboxImg-DSBDgE-_.js";import"./RadioButtonUnchecked-DyWPxD5p.js";import"./ArrowCircleDown-BpJDJL07.js";import"./ListHeaderCard3ColSel-CyrNazc1.js";import"./DoNotDisturbOn-SAoc4Fms.js";import"./QuestionMark-C2Y4lgD8.js";const qt=({rows:H,onTemplateSelect:A,IsConfirm:w})=>{const j=ve(),F=ht(j.breakpoints.down("sm")),[x,h]=s.useState("asc"),[b,E]=s.useState("Name"),[S,_]=s.useState(null),C=n=>{E(n),h(p=>p==="asc"?"desc":"asc")},B=(n,p,I)=>{_(n),A(n,p,I),console.log(n,"HHHHHHH")},f=[...H].sort((n,p)=>{const I=n.Name.localeCompare(p.Name);return x==="asc"?I:-I});return e.jsxs(a,{children:[e.jsxs(a,{display:"flex",alignItems:"center",sx:{mb:2,backgroundColor:"white"},children:[e.jsx(m,{variant:"body2",sx:{mr:1,fontWeight:"bold"},children:"Legend"}),e.jsx(a,{sx:{width:16,height:16,backgroundColor:N[50],border:"1px solid #ddd",mr:1}}),e.jsx(m,{variant:"body2",children:"System Template"})]}),F?e.jsx(a,{children:f.map(n=>e.jsx(zt,{sx:{mb:2,backgroundColor:N[50]},children:e.jsxs(Qt,{children:[e.jsxs(a,{display:"flex",alignItems:"center",children:[e.jsx(u,{children:e.jsx(Re,{color:"primary",checked:S===n.Id,value:n.Id,onChange:()=>B(n.Id,n.Value,n.RegNo)})}),e.jsxs(m,{variant:"body2",sx:{fontWeight:"bold"},children:["Registration No.: ",n.Id]})]}),e.jsx(Se,{sx:{my:1}}),e.jsx(m,{variant:"body2",sx:{fontWeight:"bold"},children:"Name:"}),e.jsx(m,{variant:"body2",children:n.Name}),e.jsx(Se,{sx:{my:1}}),e.jsx(m,{variant:"body2",sx:{fontWeight:"bold"},children:"Template:"}),e.jsx(m,{variant:"body2",children:n.Value})]})},n.Id))}):e.jsx(gt,{component:a,children:e.jsxs(St,{"aria-label":"simple table",sx:{border:n=>`1px solid ${n.palette.grey[300]}`,overflow:"hidden"},children:[e.jsx(ft,{children:e.jsxs(fe,{sx:{background:j.palette.secondary.main,color:j.palette.common.white},children:[e.jsx(u,{}),e.jsx(u,{sx:{color:"white",textAlign:"left"},children:e.jsx("strong",{children:"  Registration No.   "})}),e.jsx(u,{sx:{color:"white"},children:e.jsxs("b",{onClick:()=>C("Name"),style:{cursor:"pointer",display:"flex",alignItems:"center"},children:["Name ",b==="Name"&&(x==="asc"?e.jsx(Yt,{}):e.jsx($t,{}))]})}),e.jsx(u,{sx:{color:"white",textAlign:"left"},children:e.jsx("strong",{children:"  Template"})})]})}),e.jsx(jt,{children:f.map((n,p)=>e.jsxs(fe,{children:[e.jsx(u,{children:e.jsx(Re,{color:"primary",checked:S===n.Id,onChange:()=>B(n.Id,n.Value,n.RegNo)})}),e.jsx(u,{children:n.RegNo}),e.jsx(u,{children:n.Name}),e.jsx(u,{children:n.Value})]},p))})]})})]})},Cs=()=>{const H=bt(),A=Ct();ve(),ee.configure();const[w,j]=s.useState(!1),{showAlert:F,closeAlert:x}=s.useContext(It),[h,b]=s.useState(""),[E,S]=s.useState(""),[_,C]=s.useState(!1),[B,f]=s.useState(!1),[n,p]=s.useState("none"),[I,De]=s.useState("block");s.useState(""),s.useState("none"),s.useState(""),O.useState(new Date),s.useState(!1),s.useState("");const[Me,le]=s.useState(""),[ke,ie]=s.useState(""),[ce,V]=O.useState(""),[d,$]=s.useState({RecipientName:[],RecipientId:[],ClassId:[],ContactGroup:[]}),[Ne,Ae]=s.useState("00:00"),T=new Date;T.getHours()%12,T.getMinutes(),s.useState(""),T.getDate().toString().padStart(2,"0"),(T.getMonth()+1).toString().padStart(2,"0"),T.getFullYear();let y=new Date;y.setDate(y.getDate()+7),y.getDate().toString().padStart(2,"0"),(y.getMonth()+1).toString().padStart(2,"0"),y.getFullYear();const P=te(t=>t.getAComposeSMS.AComposeSMSTemplateList);console.log(P,"Hello"),P.GetSMSTemplates;const[R,W]=s.useState(""),[we,Jt]=s.useState();s.useState(),s.useState(0);const[de,me]=s.useState(null);O.useState("");const[Fe,pe]=O.useState(0);s.useState(0);let{AssignedDate:L}=Tt();L=yt(L);const[ue,Ee]=s.useState({scheduleSMS:!1,scheduledDate:null,scheduledTime:null});s.useState({scheduledDate:!1,scheduledTime:!1});const Be=Rt(),{state:r}=Be;s.useEffect(()=>{var t;if(r!=null&&r.activeNoList){let o=(t=r==null?void 0:r.activeNoList)==null?void 0:t.split(",");const c=o==null?void 0:o.map(l=>l.trim());b(h==null?void 0:h.concat(c))}},[r]),s.useEffect(()=>{(r==null?void 0:r.Display_Text)!==void 0&&(W(r==null?void 0:r.SMS_Text),$({RecipientName:r==null?void 0:r.Display_Text.split(","),RecipientId:r==null?void 0:r.UserId.split(",")}))},[r]);const Y=()=>{C(!1)},Pe=()=>{C(!1),le("true")},z=()=>{f(!1)},We=()=>{f(!1),ie("true")},[Kt,v]=s.useState(),Le=t=>{t.target.length>0&&v(!1),t.target.length==0&&v(!0)},Oe=t=>{t.target.value.length==0&&v(!0),t.target.value.length>0&&v(!1)},Ue=t=>{v(!1)},Q=vt(),[xe,he]=s.useState(d.RecipientName||[]);s.useEffect(()=>{he(d.RecipientName||[])},[d.RecipientName]),te(t=>t.getASendSMS.ASendSMS);const Ge=t=>{le(""),C(!0)},He=t=>{ie(""),f(!0)},_e=t=>{t.split(",").map(l=>l.trim()).filter(l=>l.length!==10||isNaN(l)).length>0?S("Each number must be 10 digits."):S("")},Ve=t=>{const o=t.target.value;b(o),_e(o)},$e=()=>{j(t=>!t),w&&(b(""),S(""))},Ye=sessionStorage.getItem("AcademicYearId"),q=localStorage.getItem("localSchoolId"),ge=sessionStorage.getItem("Id"),ze=localStorage.getItem("SchoolName"),Qe=sessionStorage.getItem("RoleId"),qe={asSchoolId:Number(q),asSortDirection:"asc",asShowSystemDefined:"N"},J=te(t=>t.SchoolSettings.SchoolSettings),K=J==null?void 0:J.SMSSenderUserName;s.useEffect(()=>{Q(Dt({asSchoolId:localStorage.getItem("SchoolId")}))},[Q]);const Je=()=>{const t={asSchoolId:q,aoMessage:{Body:R,Subject:"",SenderName:K,DisplayText:d.RecipientName.toString(),SenderUserId:ge,SenderUserRoleId:Qe,AcademicYearId:Ye,SchoolId:q,InsertedById:ge,Attachment:""},asSelectedUserIds:d.RecipientId.toString(),asSelectedStDivId:"",asIsSoftwareCordinator:0,asMessageId:0,sIsReply:"N",asIsForward:"N",asSchoolName:ze,asTemplateRegistrationId:we};Lt.SendSMS(t).then(o=>{o.status===200&&(ee.success("SMS sent successfully"),A("/RITeSchool/Teacher/SmsCenter",{state:{fromInternal:!0}}),D.resetForm())}).catch(o=>{ee.error("SMS does not sent successfully")})},D=Gt({initialValues:{From:K,To:d.RecipientName.toString(),Content:R},onSubmit:()=>{Je()},validate:t=>{const o={};return d.RecipientName.toString().length==0&&(o.To="Atleast one recipient should be selected."),(R==null||R=="")&&(o.Content="SMS content should not be blank please select SMS Template"),o}});s.useMemo(()=>{Q(Mt(qe))},[]);const Ke=["Do not use any website URL or mobile number in SMS text. Such SMS will not get delivered to selected recipient(s)."],Xe=["SMS Schedule should be set after 1 hour and within 7 days range from now."],Ze=["Enter multiple mobile numbers seperated by comma. Max 10 digit number."];s.useState(!1);const et=t=>{dt(t),$(t),p("none"),De("block")},tt=t=>{const{name:o,value:c}=t.target;Ee(l=>({...l,[o]:c}))},st=t=>{Ae(t)},[ot,nt]=s.useState(L==null?new Date().toISOString().split("T")[0]:kt(L)),rt=t=>{nt(t)},at=t=>{t!==void 0&&sessionStorage.setItem("GroupSelectionId",t)},lt=t=>{t!==void 0&&sessionStorage.setItem("GroupSelectionId1",t)},it=()=>{Pe()},ct=()=>{We()},dt=t=>{sessionStorage.getItem("GroupSelectionId")==="9"&&t.ContactGroup.length===0&&t.RecipientName.length===0?F({title:"Please Confirm",message:"No group is selected. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{x()},onConfirm:()=>{x()}}):t.RecipientName.length===0&&F({title:"Please Confirm",message:"No User is selected. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{x()},onConfirm:()=>{x()}})},mt=(t,o)=>{const c=xe.filter((l,X)=>X!==o);he(c),$(l=>({...l,RecipientName:l.RecipientName.filter((X,Z)=>Z!==o),RecipientId:l.RecipientId.filter((X,Z)=>Z!==o)}))},pt=t=>{const o=t.target.value;if(/^\d*$/.test(o)){me(o);const c=P.find(l=>l.id===o);W((c==null?void 0:c.name)||"")}o.trim()===""?V("Template Id should not be blank."):V("")},ut=t=>{W(t),pe(t.trim().length)},xt=(t,o,c)=>{me(c),W(o),pe(o.length),V("")};return e.jsx(e.Fragment,{children:e.jsxs(a,{sx:{px:2},children:[e.jsx(Nt,{navLinks:[{title:"SMS Center",path:"/RITeSchool/Teacher/SmsCenter"},{title:"Compose SMS",path:""}],rightActions:e.jsxs(e.Fragment,{children:[e.jsx(M,{title:"Send SMS to individual student / teacher or the entire school. To send sms to other mobile numbers check Add Mobile Numbers Manually checkbox and enter mobile numbers separated by comma.",children:e.jsx(se,{sx:{color:"white",backgroundColor:U[500],"&:hover":{backgroundColor:U[600]}},children:e.jsx(oe,{})})}),e.jsx(M,{title:"Send SMS",children:e.jsx(se,{onClick:()=>{D.handleSubmit()},sx:{color:"white",backgroundColor:G[500],"&:hover":{backgroundColor:G[600]}},children:e.jsx(Ut,{})})})]})}),e.jsx(At,{sx:{mb:"10px"},children:e.jsxs(wt,{defaultExpanded:!0,children:[e.jsx(Ft,{expandIcon:e.jsx(Et,{}),"aria-controls":"panel1-content",id:"panel1-header",children:e.jsx(m,{style:{fontWeight:"bold",fontSize:"20px"},children:"Important Notes"})}),e.jsxs(Bt,{sx:{gap:.1,display:"flex",flexDirection:"column"},children:[e.jsx(ne,{variant:"filled",severity:"info",sx:{mb:1,mt:"0.1px"},children:Ke}),e.jsxs(ne,{variant:"filled",severity:"info",sx:{mb:1,mt:"0.1px"},children:[" ",Xe]}),e.jsx(ne,{variant:"filled",severity:"info",children:Ze})]})]})}),e.jsx(a,{sx:{backgroundColor:"white"},children:e.jsxs("form",{onSubmit:D.handleSubmit,children:[e.jsxs(i,{container:!0,children:[e.jsx(i,{xs:12,mt:3.3,px:2,sm:2,md:3,lg:3,children:e.jsx(k,{variant:"outlined",fullWidth:!0,name:"From",label:"From",id:"from",InputProps:{readOnly:!0},sx:{bgcolor:"#F0F0F0",minWidth:"100%",marginTop:"20px","& .MuiInputBase-input":{cursor:"default"}},value:K})}),e.jsxs(i,{xs:12,sm:7,md:6,lg:7.1,spacing:1,px:2,children:[e.jsx(re,{control:e.jsx(ae,{checked:w,onChange:$e,color:"primary"}),label:"Add Mobile Numbers Manually"}),e.jsx(k,{disabled:!w,multiline:!0,fullWidth:!0,placeholder:"Enter multiple mobile numbers separated by commas",value:h,onChange:Ve,error:!!E,helperText:E||"(Enter multiple mobile numbers separated by comma. Max 10-digit numbers.)",sx:{marginTop:"8px",height:"50px",borderRadius:"5px"}})]}),e.jsx(i,{xs:12,mt:6,sm:2,md:1,lg:1.9,children:e.jsx(a,{sx:{mt:{xs:"10px",sm:"10px",md:"10px",lg:"10px"}},children:e.jsx(g,{fullWidth:!0,sx:{color:"#38548A",mt:.7,width:"187px","&:hover":{color:"#38548A",backgroundColor:N[100]}},onClick:()=>{A("/RITeSchool/teacher/PersonalAddressBook",{state:{mobileNumbers:h,fromInternal:!0}})},children:"Personal Address book"})})})]}),e.jsxs(i,{container:!0,gap:2,children:[e.jsxs(i,{xs:12,sm:9,md:10,lg:10.2,px:2,children:[e.jsx(a,{sx:{mt:{xs:"10px",sm:"30px",md:"10px",lg:"10px"}},children:e.jsx(k,{label:e.jsxs("span",{style:{color:"#38548A",marginTop:"10px"},children:["To ",e.jsx("span",{style:{color:"red"},children:"*"})]}),multiline:!0,className:H.InputField,onChange:Le,onBlur:Oe,onFocus:Ue,InputProps:{startAdornment:e.jsx(a,{sx:{display:"flex",flexWrap:"wrap",overflowY:"scroll",minWidth:"100%",height:"100px"},children:xe.map((t,o)=>e.jsx(Pt,{label:t==null?void 0:t.trim(),onDelete:()=>mt(t,o),sx:{my:1,mx:.5}},o))}),readOnly:!0},value:"",id:"body",fullWidth:!0})}),e.jsx("div",{style:{marginTop:"15px"},children:e.jsx(ye,{Error:D.errors.To})})]}),e.jsx(i,{xs:12,sm:2,md:1,lg:1.2,mt:2,children:e.jsx(a,{sx:{mt:{xs:"10px",sm:"30px",md:"50px",lg:"50px"}},children:e.jsx(g,{fullWidth:!0,onClick:()=>Ge(),sx:{color:"#38548A",mt:.7,width:"140px","&:hover":{color:"#38548A",backgroundColor:N[100]}},children:"Add Recipients"})})})]}),e.jsxs(i,{container:!0,spacing:2,px:2,mt:0,children:[e.jsx(i,{item:!0,xs:12,sm:6,md:2,lg:2,children:e.jsx(re,{control:e.jsx(ae,{name:"SendMessage"}),label:"Send Message"})}),e.jsxs(i,{item:!0,xs:12,sm:6,md:4,lg:2,children:[e.jsx(re,{control:e.jsx(ae,{name:"scheduleSMS",checked:ue.scheduleSMS,onChange:tt}),label:"Schedule SMS"}),e.jsx(M,{title:`10:00 AM. SMS Schedule should be set after 1 hour\r
                                        and within 7 days range from now.`,children:e.jsx(se,{size:"small",style:{marginLeft:8,color:"#38548A"},children:e.jsx(Ot,{fontSize:"small"})})})]}),ue.scheduleSMS&&e.jsxs(e.Fragment,{children:[e.jsx(i,{item:!0,xs:12,sm:6,md:3,lg:2.1,children:e.jsx(Wt,{DateValue:ot,onDateChange:rt,size:"medium",label:"Date"})}),e.jsx(i,{item:!0,xs:12,sm:6,md:3,lg:2,children:e.jsx(Ht,{Item:Ne,label:"Time",isMandatory:!1,ClickItem:st,size:"medium",tooltipMessage:"e.g. 10:00 AM"})})]}),e.jsx(i,{item:!0,xs:12,sm:6,md:4,lg:1.5,children:e.jsx(k,{name:"TemplateId",label:e.jsxs("span",{children:["Template Id ",e.jsx("span",{style:{color:"red"},children:"*"})]}),variant:"outlined",value:de,onChange:pt,fullWidth:!0,InputLabelProps:{shrink:!!de||void 0},error:!!ce,helperText:ce})}),e.jsx(i,{xs:2,mt:2,sm:2,md:1.7,children:e.jsx(a,{children:e.jsx(g,{fullWidth:!0,sx:{color:"#38548A",mt:.7,width:"130px","&:hover":{color:"#38548A",backgroundColor:N[100]}},onClick:()=>He(),children:"Use Template"})})})]}),e.jsxs(a,{px:2,children:[e.jsxs(Vt,{sx:{color:"blue",marginTop:0,marginBottom:1.5,fontWeight:"bold"},children:[" ","Letters = ",Fe,"  Message = ","0"," "]}),e.jsx(k,{fullWidth:!0,multiline:!0,rows:4,margin:"normal",name:"Content",type:"text",value:R,onBlur:()=>console.log("Blurred"),sx:{marginTop:"1px"},id:"content",onChange:t=>ut(t.target.value),inputProps:{maxLength:306}}),e.jsx(a,{style:{marginTop:"8px"},children:e.jsx(ye,{Error:D.errors.Content})})]})]})}),e.jsxs(je,{open:_,onClose:Y,fullWidth:!0,maxWidth:"md",PaperProps:{sx:{borderRadius:"15px"}},children:[e.jsxs(be,{sx:{bgcolor:"#223354"},children:[e.jsx(M,{title:'Select name of the teacher / student / admin staff / other staff and click on " Confirm " button.',placement:"bottom-end",children:e.jsx(oe,{sx:{color:"white",borderRadius:"10px",position:"absolute",top:"4px",right:"35px",cursor:"pointer","&:hover":{backgroundColor:U[600]}}})}),e.jsx(Ce,{onClick:Y,sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"8px",cursor:"pointer","&:hover":{color:"red"}}})]}),e.jsx(m,{variant:"h3",sx:{pt:2,pl:3},children:"Add Recipients"}),e.jsx(Ie,{children:e.jsx(a,{children:e.jsx(_t,{getGroupRadio:at,RecipientName:d.RecipientName,RecipientId:d.RecipientId,recipientListClick:et,contactGroupList:d.ContactGroup,classIdList:d.ClassId,IsConfirm:Me,getGroupRadio1:lt})})}),e.jsxs(Te,{sx:{m:2},children:[e.jsx(g,{onClick:Y,color:"error",children:"Cancel"}),e.jsx(g,{onClick:()=>{it()},sx:{color:"green","&:hover":{color:"green",backgroundColor:G[100]}},children:"Confirm"})]})]}),e.jsxs(je,{open:B,onClose:z,fullWidth:!0,maxWidth:"lg",PaperProps:{sx:{borderRadius:"15px"}},children:[e.jsxs(be,{sx:{bgcolor:"#223354"},children:[e.jsx(M,{title:"Select the required template to create the SMS.",placement:"bottom-end",children:e.jsx(oe,{sx:{color:"white",borderRadius:"10px",position:"absolute",top:"4px",right:"35px",cursor:"pointer","&:hover":{backgroundColor:U[600]}}})}),e.jsx(Ce,{onClick:z,sx:{color:"white",borderRadius:"7px",position:"absolute",top:"5px",right:"8px",cursor:"pointer","&:hover":{color:"red"}}})]}),e.jsx(m,{variant:"h3",sx:{pt:2,pl:3},children:"Use Template"}),e.jsx(Ie,{children:e.jsx(a,{children:e.jsx(qt,{rows:P,IsConfirm:ke,onTemplateSelect:xt})})}),e.jsxs(Te,{sx:{py:2,px:3},children:[e.jsx(g,{color:"error",onClick:z,children:"Cancel"}),e.jsx(g,{onClick:()=>{ct()},sx:{color:"green","&:hover":{color:"green",backgroundColor:G[100]}},children:"Select"})]})]})]})})};export{Cs as default};
