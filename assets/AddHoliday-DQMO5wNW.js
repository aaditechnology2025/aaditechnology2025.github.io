import{w as pe,x as ve,A as ke,u as Te,r as a,E as we,aB as m,c as d,aC as Ne,aD as Re,aE as W,aF as Be,aG as Le,t as K,aH as _e,j as t,B as O,F as Fe,H as q,I as J,K as Pe,L as A,G as n,aI as $,aJ as i,q as Q,T as Ye,p as Me,a8 as X,as as Ve,aK as Z,aL as E,aM as ze,aN as Ge}from"./index-d5YOjbb6.js";import{d as Ue}from"./Save-Ckr0NoeK.js";import{R as We}from"./ResizableTextField1-DPLma9Eu.js";import{S as Ke}from"./SelectListHierarchy-2EYf6pPL.js";const et=({})=>{let{Holiday_Id:r}=pe();r=ve(r);const ee=ke(),c=Te(),[I,b]=a.useState([]),{showAlert:te,closeAlert:p}=a.useContext(we),D=Number(localStorage.getItem("localSchoolId")),h=Number(sessionStorage.getItem("AcademicYearId")),[o,y]=a.useState(m(new Date)),[ae,v]=a.useState(""),[l,f]=a.useState(m(new Date)),[se,k]=a.useState(""),[S,x]=a.useState(""),[re,T]=a.useState(""),[oe,w]=a.useState(""),[le,N]=a.useState(""),[ie,R]=a.useState(""),[ne,g]=a.useState(1),[B,H]=a.useState(""),[L,Oe]=a.useState(""),[de,_]=a.useState(""),[ce,F]=a.useState(""),[ue,P]=a.useState(""),[me,qe]=a.useState(""),Se=Number(localStorage.getItem("UserId"));a.useState();const[Je,De]=a.useState(""),Y=d(e=>e.Holidays.AllClassesAndDivisionss),he=d(e=>e.Holidays.AllClassesAndDivisionss1),M=d(e=>e.Holidays.SaveHoliday),ye=d(e=>e.Holidays.IHolidayDuplicateNameValidationCount),u=d(e=>e.Holidays.EditHolidayDetails),fe=d(e=>e.Holidays.IHolidayStartAndEndDatePredefinedValidationCount);d(e=>e.Holidays.Loading);const V=ye.filter(e=>e.DuplicateHolidayNameCount),Ee=V.length>0?V[0]:null,z=fe.filter(e=>e.PredefinedStartDateAndEndDateCount),xe=z.length>0?z[0]:null;a.useEffect(()=>{const e=new Date(o),be=new Date(l).getTime()-e.getTime();let j=Math.ceil(be/(1e3*60*60*24)+1);j<0&&(j=0),g(j)},[o,l]);const G=()=>{let e=[];return I.map(s=>{s.IsActive&&e.push(s.Id)}),e.toString()},C=G();a.useEffect(()=>{if(r!=null){const e={asHoliday_Id:Number(r),asSchoolId:Number(D),asAcademicYearID:Number(h)};c(Ne(e))}else c(Re())},[]),a.useEffect(()=>{if(r!=null&&u.length>0&&u[0]!=null){const s=u[0];y(W(s.Holiday_Start_Date)),f(W(s.Holiday_End_Date)),x(s.Holiday_Name),H(s.Remarks),De(s.AssociatedStandard)}const e={asSchoolId:D,asAcademicYearId:h,associatedStandard:r==null||u.length==0?[]:u[0].AssociatedStandard};c(Be(e))},[u]);const ge={asHolidayName:S.trim(),asRemarks:B,asStartDate:o,asEndDate:l,asSchoolId:D,asAcademicYearID:h,asInsertedById:Se,asAssociatedStandard:C,asHoliday_Id:Number(r||0)};a.useEffect(()=>{const e={asSchoolId:D,asAcademicYearId:h,asStandardDivIds:C,asHolidayId:Number(r||0),asHolidayName:S.trim(),asHolidayStartDate:o,asHolidayEndDate:l};c(Le(e))},[C,o,l,S]),a.useEffect(()=>{b(Y)},[Y]);const He=e=>{b(e)},Ce=e=>{console.log(e,"value"),e==null?y(""):y(m(e))},je=e=>{e==null?f(""):f(m(e))},Ae=()=>{let e=!1,s=!1;S.trim()==""?(T("Name should not be blank."),e=!0):T(""),G()?_(""):(_("At least one class should be associated."),e=!0),o===""?(N("Start date should not be blank."),s=!0,e=!0):N(""),l==""?(R("End date should not be blank."),s=!0,e=!0):R(""),s==!1&&(Z(o)?(v("Holiday start date must be within current academic year (i.e between "+E(sessionStorage.getItem("StartDate"))+" and "+E(sessionStorage.getItem("EndDate"))+")."),s=!0,e=!0):v(""),Z(l)?(k("Holiday end date must be within current academic year (i.e between "+E(sessionStorage.getItem("StartDate"))+" and "+E(sessionStorage.getItem("EndDate"))+")."),s=!0,e=!0):k("")),ze(l,o)?(F("End date should not be less than start date."),s=!0,e=!0):F(""),xe.PredefinedStartDateAndEndDateCount!=="0"&&s==!1?(P("Holiday already defined."),e=!0):P(""),Ee.DuplicateHolidayNameCount!=="0"?(w("Holiday name already exists."),e=!0):w(""),e||c(Ge(ge))};a.useEffect(()=>{M!=""&&(r?K.success("Holiday details updated successfully.",{toastId:"success1"}):K.success("Holiday details saved successfully.",{toastId:"success1"}),c(_e()),ee("/RITeSchool/Admin/SchoolConfiguration/Holidays",{state:{fromInternal:!0}}))},[M]),a.useEffect(()=>{(o===""||l==="")&&g(0)},[o,l]);const U=()=>{te({title:"Please Confirm",message:"Are you sure you want to save holiday?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{p()},onConfirm:()=>{Ae(),p()}})},Ie=()=>{y(m(new Date)),f(m(new Date)),x(""),g(1),H("")};return t.jsx(t.Fragment,{children:t.jsxs(O,{sx:{px:2},children:[t.jsx(Fe,{navLinks:[{title:"Holidays",path:"/RITeSchool/Admin/SchoolConfiguration/Holidays"},r?{title:"Edit Holiday",path:"/RITeSchool/Admin/SchoolConfiguration/EditHoliday/"}:{title:"Add Holiday",path:"/RITeSchool/Admin/SchoolConfiguration/AddHoliday"}],rightActions:t.jsxs(t.Fragment,{children:[t.jsx(q,{title:"Declare a new classwise holiday for your school.",children:t.jsx(J,{sx:{bgcolor:"grey.500",color:"white","&:hover":{bgcolor:"grey.600"}},children:t.jsx(Pe,{})})}),t.jsx(q,{title:"Save",children:t.jsx(J,{onClick:U,sx:{background:A[500],color:"white","&:hover":{backgroundColor:A[600]}},children:t.jsx(Ue,{})})})]})}),t.jsx(O,{sx:{p:2,background:"white"},children:t.jsxs(n,{container:!0,spacing:2,children:[t.jsxs(n,{item:!0,xs:12,sm:6,md:6,lg:4,children:[t.jsx($,{DateValue:o,onDateChange:Ce,label:"Start Date",size:"medium"}),t.jsx(i,{Error:ae}),t.jsx(i,{Error:me}),t.jsx(i,{Error:le})]}),t.jsxs(n,{item:!0,xs:12,sm:6,md:6,lg:4,children:[t.jsx($,{DateValue:l,onDateChange:je,label:"End Date",size:"medium"}),t.jsx(i,{Error:se}),t.jsx(i,{Error:ce}),t.jsx(i,{Error:ue}),t.jsx(i,{Error:ie})]}),t.jsx(n,{item:!0,xs:12,sm:6,md:6,lg:4,children:t.jsx(Q,{label:"Total Days",value:ne,InputProps:{readOnly:!0},fullWidth:!0})}),t.jsxs(n,{item:!0,xs:12,sm:6,md:6,lg:6,children:[t.jsx(Q,{label:t.jsxs("span",{children:["Name ",t.jsx("span",{style:{color:"red"},children:"*"})]}),rows:1,value:S,onChange:e=>{const s=e.target.value;x(s.slice(0,50))},fullWidth:!0,sx:{resize:"both"}}),t.jsx(i,{Error:re}),t.jsx(i,{Error:oe})]}),t.jsx(n,{item:!0,xs:12,sm:12,md:12,lg:6,children:t.jsx(We,{label:t.jsx("span",{children:"Remark"}),multiline:!0,minRows:1,value:B,onChange:e=>{const s=e.target.value;s.length<=200&&H(s)},fullWidth:!0,error:L!=="",helperText:L})}),t.jsxs(n,{item:!0,xs:12,md:12,children:[t.jsxs(Ye,{variant:"h6",children:["Associated Classes ",t.jsx("span",{style:{color:"red"},children:"*"})]}),t.jsx(Ke,{ItemList:I,ParentList:he,ClickChild:He}),t.jsx(i,{Error:de})]}),t.jsx(n,{item:!0,xs:12,md:12,children:t.jsxs(Me,{direction:"row",gap:2,alignItems:"center",children:[t.jsx(X,{sx:{color:"red",":hover":{backgroundColor:Ve[100]}},onClick:Ie,children:"Clear"}),t.jsx(X,{sx:{color:"green",":hover":{backgroundColor:A[100]}},onClick:U,children:"Save"})]})})]})})]})})};export{et as default};
