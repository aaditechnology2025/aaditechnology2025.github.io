import{S as Z,A as $,h as ee,t as u,r as o,c as y,u as te,e7 as se,e8 as oe,j as e,B as x,a9 as v,q as f,G as a}from"./index-d5YOjbb6.js";import{u as ne}from"./formik.esm-DT8TU67t.js";import{E as M}from"./Errormessage-RPRSgLGN.js";import{N as re}from"./Note-DS5-MtV-.js";import{B as ae}from"./BackButton-BE5_8L9j.js";import{P as ie}from"./PageHeader-DqqjGq3-.js";import{B as N}from"./ButtonStyle-DaPKUawX.js";import{L as le,C as ce}from"./CardStyle-B9qFmFtz.js";import{A as de}from"./AddReciepents-D_RJXJSl.js";import{N as me}from"./NativeSelect-Dod2zX5v.js";import"./Card-BrM9kpJu.js";import"./GroupAdd-CeGlO5QJ.js";import"./Square-gela0mjc.js";import"./Search-Cux6sdg-.js";import"./ListSelect-XR4RTIQy.js";import"./CheckboxImg-DSBDgE-_.js";import"./RadioButtonUnchecked-DyWPxD5p.js";import"./ArrowCircleUp-BmCXupv-.js";import"./ArrowCircleDown-BpJDJL07.js";import"./ListHeaderCard3ColSel-CyrNazc1.js";import"./DoNotDisturbOn-SAoc4Fms.js";import"./QuestionMark-C2Y4lgD8.js";const Oe=()=>{const b=Z(),A=$();ee(),u.configure();const[B,I]=o.useState("none"),[F,C]=o.useState("block"),[r,P]=o.useState({RecipientName:[],RecipientId:[]}),k=t=>{I("block"),C("none")},i=y(t=>t.getAComposeSMS.AComposeSMSTemplateList).GetSMSTemplates,[l,m]=o.useState(),[D,T]=o.useState(),[ue,E]=o.useState(),[L,p]=o.useState(0),[w,S]=o.useState(0),O=t=>{if(t.target.value!=""){const s=t.target.value.indexOf(","),R=t.target.value.slice(0,s),n=t.target.value.slice(s).replace(",","");n.length>=300&&u.error("More than 300 characters not allowed"),n.length>=1&&n.length<=160&&(p(1),m(n),T(R)),n.length>160&&(confirm("SMS will be send in 2 parts for each selected user(s). Are you sure to continue?"),p(2),m(n),T(R)),n.length==0&&p(0),S(n.length)}else m(""),S(0),p(0)},G=t=>{E(!1)},[Se,c]=o.useState(),U=t=>{t.target.length>0&&c(!1),t.target.length==0&&c(!0)},W=t=>{t.target.value.length==0&&c(!0),t.target.value.length>0&&c(!1)},_=t=>{c(!1)},V=te();y(t=>t.getASendSMS.ASendSMS);const Y=sessionStorage.getItem("AcademicYearId"),g=localStorage.getItem("localSchoolId"),j=sessionStorage.getItem("Id"),H=localStorage.getItem("SchoolName"),q=sessionStorage.getItem("RoleId"),h=JSON.parse(localStorage.getItem("SchoolSettingsValue")).SMSSenderUserName,J={asSchoolId:Number(g),asSortDirection:"asc",asShowSystemDefined:"Y"},d=ne({initialValues:{From:h,To:r.RecipientName.toString(),Content:l},onSubmit:()=>{z()},validate:t=>{const s={};return r.RecipientName.toString().length==0&&(s.To="Atleast one recipient should be selected."),(l==null||l=="")&&(s.Content="SMS content should not be blank please select SMS Template"),s}}),z=()=>{const t={asSchoolId:g,aoMessage:{Body:l,Subject:"",SenderName:h,DisplayText:r.RecipientName.toString(),SenderUserId:j,SenderUserRoleId:q,AcademicYearId:Y,SchoolId:g,InsertedById:j,Attachment:""},asSelectedUserIds:r.RecipientId.toString(),asSelectedStDivId:"",asIsSoftwareCordinator:0,asMessageId:0,sIsReply:"N",asIsForward:"N",asSchoolName:H,asTemplateRegistrationId:D};se.SendSMS(t).then(s=>{s.status===200&&(u.success("SMS sent successfully"),A("/RITeSchool/SMSCenter/smsCenter",{state:{fromInternal:!0}}),d.resetForm())}).catch(s=>{u.error("SMS does not sent successfully")})};o.useMemo(()=>{V(oe(J))},[]);const K=["Do not use any website URL or mobile number in SMS text. Such SMS will not get delivered to selected recipient(s)."];o.useState(!1);const Q=t=>{P(t),I("none"),C("block")},X=t=>{m(t),S(t.length)};return e.jsxs(x,{sx:{px:2},children:[e.jsx(ie,{heading:"Compose SMS",subheading:""}),e.jsxs(x,{style:{display:F},children:[e.jsx(ae,{FromRoute:"/SMSCenter/smsCenter"}),e.jsxs(e.Fragment,{children:[e.jsx(le,{sx:{},children:e.jsxs("form",{onSubmit:d.handleSubmit,children:[e.jsxs(v,{fullWidth:!0,children:[e.jsx(f,{sx:{marginBottom:"-10px"},variant:"standard",name:"From",label:"From",id:"from",InputProps:{readOnly:!0},value:h}),e.jsx(x,{sx:{mt:"15px"},children:e.jsx(f,{name:"To",placeholder:"To",multiline:!0,className:b.InputField,onChange:U,onBlur:W,onFocus:_,InputProps:{readOnly:!0},value:r.RecipientName,variant:"outlined",id:"body",fullWidth:!0,margin:"normal",style:{scrollBehavior:"auto"},sx:{maxHeight:"60px",overflow:"auto"}})}),e.jsx("div",{style:{marginTop:"15px"},children:e.jsx(M,{Error:d.errors.To})})]}),e.jsx(a,{container:!0,children:e.jsx(a,{item:!0,md:3,children:e.jsx(N,{fullWidth:!0,onClick:k,children:"Add Recipients"})})}),e.jsx(a,{container:!0,style:{marginTop:"12px",marginBottom:"17px"},children:e.jsx(a,{item:!0,xs:12,children:e.jsx(v,{fullWidth:!0,children:e.jsxs(me,{onChange:O,style:{borderRadius:"2px solid black"},children:[e.jsx("option",{value:"",children:"Select SMS Template Name"}),i==null||i.length==0?null:i==null?void 0:i.map((t,s)=>e.jsx("option",{value:t.RegNo+","+t.Template,children:t.Name},s))]})})})}),e.jsxs(ce,{sx:{color:"blue",marginTop:1,marginBottom:1.5,fontWeight:"bold"},children:[" ","Letters = ",w," Message = ",L," "]}),e.jsx(f,{fullWidth:!0,multiline:!0,rows:4,margin:"normal",name:"Content",type:"text",value:l,onBlur:G,sx:{marginTop:"1px"},id:"content",onChange:t=>X(t.target.value)}),e.jsx("div",{style:{marginTop:"8px"},children:e.jsx(M,{Error:d.errors.Content})}),e.jsx("br",{}),e.jsx(a,{container:!0,children:e.jsx(a,{item:!0,xs:12,children:e.jsx(N,{type:"submit",fullWidth:!0,onClick:d.handleChange,children:"Send"})})})]})}),e.jsx(re,{NoteDetail:K})]})]}),e.jsx("div",{style:{display:B},children:e.jsx(de,{RecipientName:r.RecipientName,RecipientId:r.RecipientId,recipientListClick:Q,contactGroupList:void 0,classIdList:void 0,IsConfirm:void 0,getGroupRadio:void 0,getGroupRadio1:void 0})})]})};export{Oe as default};
