import{V as Z,W as ee,j as s,s as Re,al as H,am as z,c8 as ps,ai as bs,aj as Ss,ak as Is,r as a,B as L,an as Cs,bh as Rs,u as vs,A as js,w as Ts,x as As,E as ys,ah as Ps,c as i,I as C,m as f,ab as ws,iy as Ns,iz as Ds,iA as Gs,iB as ks,iC as Fs,t as V,iD as _s,iE as P,iF as w,iG as E,iH as Bs,iI as Es,iJ as Ls,iK as Ms,iL as Us,iM as $s,F as Vs,p as Ys,G as Ie,hh as Hs,H as N,J as Ce,K as zs,bv as m,bw as Os,as as X,hg as qs,iN as Ws,T as Y,R as Js,ay as Ks,iO as Qs,iP as Xs,iQ as Zs,dd as et,iR as st}from"./index-d5YOjbb6.js";import{d as tt}from"./Assignment-BGrYD-58.js";import at from"./FinalResultUnpublish-BkZvVqH_.js";import{d as lt}from"./ArrowCircleUp-BmCXupv-.js";import{A as nt}from"./ArrowCircleDown-BpJDJL07.js";var se={},ot=ee;Object.defineProperty(se,"__esModule",{value:!0});var ve=se.default=void 0,rt=ot(Z()),it=s,dt=(0,rt.default)((0,it.jsx)("path",{d:"M12 6v3l4-4-4-4v3c-4.42 0-8 3.58-8 8 0 1.57.46 3.03 1.24 4.26L6.7 14.8c-.45-.83-.7-1.79-.7-2.8 0-3.31 2.69-6 6-6zm6.76 1.74L17.3 9.2c.44.84.7 1.79.7 2.8 0 3.31-2.69 6-6 6v-3l-4 4 4 4v-3c4.42 0 8-3.58 8-8 0-1.57-.46-3.03-1.24-4.26z"}),"Autorenew");ve=se.default=dt;var te={},ct=ee;Object.defineProperty(te,"__esModule",{value:!0});var je=te.default=void 0,ut=ct(Z()),ht=s,ft=(0,ut.default)((0,ht.jsx)("path",{d:"M11 7h2v2h-2zm0 4h2v6h-2zm1-9C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"}),"InfoOutlined");je=te.default=ft;var ae={},gt=ee;Object.defineProperty(ae,"__esModule",{value:!0});var Te=ae.default=void 0,xt=gt(Z()),mt=s,pt=(0,xt.default)((0,mt.jsx)("path",{d:"m20.41 8.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9.83c0-.53-.21-1.04-.59-1.42zM7 7h7v2H7V7zm10 10H7v-2h10v2zm0-4H7v-2h10v2z"}),"TextSnippet");Te=ae.default=pt;const bt=Re(H)(({theme:t})=>`
  background-color: ${t.palette.secondary.main};
 `),St=Re(z)(({theme:t})=>`
  color: white;
  font-weight: bold;
 `),It=({columns:t,data:R,isLoading:p=!1,clickHeader:M,sortby:D,sortAsc:o})=>s.jsx(ps,{children:s.jsx(bs,{children:s.jsxs(Ss,{children:[s.jsx(Is,{children:s.jsx(bt,{children:t.map((g,b)=>a.createElement(St,{...g.headerCellProps,key:g.id,onClick:()=>{b<t.length-3&&M(g.label)},style:{cursor:b<t.length-3?"pointer":"default"}},s.jsxs(L,{sx:{display:"flex",gap:.5},children:[g.renderHeader?g.renderHeader():g.label,g.label===D&&(o==="Desc"?s.jsx(lt,{}):s.jsx(nt,{}))]})))})}),s.jsx(Cs,{children:p?s.jsx(H,{children:s.jsx(z,{colSpan:t.length,align:"center",sx:{paddingTop:"2.5px",paddingBottom:"2.5px"},children:s.jsx(Rs,{})})}):R.length===0?s.jsx(H,{children:s.jsx(z,{colSpan:t.length,align:"center",sx:{paddingTop:"2.5px",paddingBottom:"2.5px"},children:"No data available"})}):R.map((g,b)=>s.jsx(H,{children:t.map(r=>a.createElement(z,{...r.cellProps,key:r.id,sx:{paddingTop:"2.5px",paddingBottom:"2.5px"}},r.renderCell(g)))},b))})]})})}),_t=()=>{var me,pe;const t=vs(),R=js();let{StandardDivisionId1:p}=Ts();a.useEffect(()=>{p!==void 0&&(p=As(p))},[p]);const[M,D]=a.useState(!1),o=Number(localStorage.getItem("localSchoolId")),{showAlert:g,closeAlert:b}=a.useContext(ys),r=Number(sessionStorage.getItem("AcademicYearId"));localStorage.getItem("Id");const Ae=Number(sessionStorage.getItem("TeacherId"));a.useState(""),a.useState(!0);const ye=sessionStorage.getItem("StandardDivisionId"),G=Ps("Final Result");a.useState();const[Pe,Ct]=a.useState(),le=Number(localStorage.getItem("UserId")),[we,Rt]=a.useState("Y"),[O,vt]=a.useState();a.useState(),a.useState();const[x,Ne]=a.useState(20),De=[20,50,100,200],[S,ne]=a.useState(1),oe=sessionStorage.getItem("RoleId"),re=sessionStorage.getItem("Id"),Ge=["Final Result"],ke=(e,n)=>{let h="";return e.map(I=>{I.Value==n&&(h=I.Name)}),h};i(e=>e.FinalResult.Loading);const d=i(e=>e.FinalResult.GetAtleastOneResultGenerated),c=i(e=>e.FinalResult.ISGetResultPublishd),v=i(e=>e.FinalResult.ClassTeachers),[l,ie]=a.useState(G==="Y"?"0":ye),u=l==="0",Fe=a.useMemo(()=>[{id:"rollNo",label:"Roll No.",renderCell:e=>e.Text1},{id:"studentName",label:"Student Name",renderCell:e=>e.Text2},{id:"total",label:"Total",renderCell:e=>e.Text3},{id:"percentage",label:"%",renderCell:e=>e.Text4},{id:"grade",label:"Grade",renderCell:e=>e.Text5},{id:"result",label:"Result",renderCell:e=>e.Text6},{id:"generate",label:"Generate",renderCell:e=>!c||u?s.jsx(C,{onClick:()=>{R("/RITeSchool/Teacher/GenerateAll/"+f(e.Id)+"/"+f(e.Text7)+"/"+f(!1)+"/"+f(l),{state:{fromInternal:!0,fromView:!1}})},sx:{display:"flex",justifyContent:"center",alignItems:"center",ml:2},children:s.jsx(tt,{})}):null},{id:"view",label:"View",renderCell:e=>e.CanShowVisibility?s.jsx(C,{onClick:()=>{R("/RITeSchool/Teacher/GenerateAll/"+f(e.Id)+"/"+f("Y")+"/"+f(!0)+"/"+f(l),{state:{fromInternal:!0,fromView:!0}})},sx:{display:"flex",justifyContent:"center",alignItems:"center"},children:s.jsx(ws,{})}):null},{id:"grace",label:"Grace",renderCell:e=>e.grace}],[c,u]),j=i(e=>e.FinalResult.StudentResultList);j.map(e=>e.Is_ResultGenrated)[0];const de=i(e=>e.FinalResult.StudentResultList1).NotGenratedResultCount,T=i(e=>e.ProgressReportNew.IsGetSchoolSettings),ce=((me=T==null?void 0:T.GetSchoolSettingsResult)==null?void 0:me.BlockExamPublish)||"",_e=((pe=T==null?void 0:T.GetSchoolSettingsResult)==null?void 0:pe.ShowTopppers)||"",q=i(e=>e.FinalResult.PublishResult),W=i(e=>e.FinalResult.UnpublishResult),J=i(e=>e.FinalResult.GenerateAll);i(e=>e.FinalResult.ViewResult),i(e=>e.FinalResult.Generate),i(e=>e.FinalResult.GetConfiguredTestPublished);const U=i(e=>e.FinalResult.GetTestPublished);d.length>0&&d[0].AllowPublish;const Be=i(e=>e.getSchoolSettings.getUserDetails),Ee=i(e=>e.FinalResult.iscofigred),ue=i(e=>e.FinalResult.unpublishexam),Le=j.filter(e=>e.TotalRows!==void 0).map(e=>e.TotalRows),k=[...new Set(Le)][0],Me=(S-1)*x+1,he=Math.min(S*x,k),Ue=Math.ceil(k/x),A=(S-1)*x,$=A+x;a.useEffect(()=>{t(Ns(Oe))},[O]),a.useEffect(()=>{t(Ds(qe))},[]),a.useEffect(()=>{const e={asSchoolId:String(o),asUserId:re,asRoleId:oe};t(Gs(e))},[]);const $e={asSchoolId:Number(o)},fe=()=>{let e=0;return v.map(n=>{n.Value==l&&(e=n.Id)}),e},[ge,Ve]=a.useState("Roll No."),[K,Ye]=a.useState("Desc"),He=e=>{Ve(e),e===ge&&Ye(K==="Asc"?"Desc":"Asc");const n=K==="Desc"?" Desc":"",h=e==="Roll No."?"Roll_No":e==="Student Name"?"Name":e==="Total"?"Marks":e==="%"?"Percentage":e==="Grade"?"Grade_Name":e==="Result"?"Result":"",I={asSchoolId:o.toString(),asAcademicyearId:r.toString(),asStandardDivisionId:l,SortExp:`ORDER BY ${h}${n}`,prm_StartIndex:(S-1)*x,PageSize:S*x};t(P(I))},ze={asSchoolId:o,asAcademicYearId:r,asTeacherId:G=="Y"?"0":Ae},F={asSchoolId:o.toString(),asAcademicyearId:r.toString(),asStandardDivisionId:l,SortExp:"ORDER BY Roll_No",prm_StartIndex:A,PageSize:$},Oe={asSchoolId:o,asAcademicYearId:r,asStudentId:O,asInsertedById:1,asWithGrace:0},qe={asSchoolId:o,asAcadmeicYearId:r,asStudentId:O,asUserId:le},We={asSchoolId:o,asAcademicYrId:r,asStdDivId:Number(l)},y={asSchoolId:o,asAcadmicYearId:r,asStdDivId:Number(l)},Je={asSchoolId:o,asAcadmicYearId:r,asStdDivId:Number(l)},_={asSchoolId:o,asAcadmicYearId:r,asStdDivId:Number(l),asStandardId:0},Ke={asSchoolId:o,asAcademicYrId:r,asStdDivId:Number(l)},Qe={asSchoolId:o,asAcademicYrId:r,asStdDivId:Number(l)},[Xe,Ze]=a.useState(""),[es,ss]=a.useState(""),ts=e=>{var n,h;ie(e.Value),Ze((n=e.Name)==null?void 0:n.split(":")[1]),ss((h=e.Name)==null?void 0:h.split(":")[0])},as=()=>{const e=localStorage.getItem("SchoolId"),n=localStorage.getItem("SchoolName");return e==="18"?"PPS Pune":e==="1"?"SS Pune":n},ls=()=>{let e=!1;return v.map(n=>{n.Value==l&&(e=n.StanderdId)}),e};a.useEffect(()=>{t(ks(ze))},[fe()]);const ns=ls();a.useEffect(()=>{p!==void 0&&ie(p)},[p]),a.useEffect(()=>{t(Fs($e))},[]);const os=e=>{R("/RITeSchool/Teacher/Toppers/"+f(fe())+"/"+f(l)+"/"+f(ns)+"/"+f(!0),{state:{fromInternal:!0}})},rs=()=>{D(!0)},is=()=>{D(!1)},ds=e=>{ne(e)},cs=e=>{Ne(parseInt(e.target.value,10)),ne(1)},us=(e,n="")=>{if(Pe!==""){const h={asSchoolId:o,asAcademicYearId:r,asStandardDivId:Number(l),asUnPublishReason:e?null:n};t(Qs(h)),t(w(y)),t(P(F))}},hs=()=>{const e={asSchoolId:o,asAcademicYearId:r,asStdDivId:Number(l),asUserId:le,asUseAvarageFinalResult:we};t(Xs(e))},[Pt,Q]=a.useState(!1),[wt,xe]=a.useState(!1),fs=()=>{let n=st.MessageTemplate.FinalResultExamMessage;n=n.replace("%Classteacher%",Xe),n=n.replace("%studentclass%",es),n=n.replace("%SCHOOL_NAME%",as());let h=localStorage.getItem("SchoolName"),I=sessionStorage.getItem("Id"),B=sessionStorage.getItem("AcademicYearId"),be=localStorage.getItem("SchoolId"),xs=sessionStorage.getItem("StudentName");const ms={asSchoolId:be,aoMessage:{Body:n,Subject:"Final Exam result",SenderName:xs,DisplayText:"",SenderUserId:I,SenderUserRoleId:oe,AcademicYearId:B,SchoolId:be,InsertedById:I,Attachment:"",ScheduleDateTime:"",RequestReadReceipt:"0"},asIsForward:"N",asIsSoftwareCordinator:0,asMessageId:0,asSchoolName:h,asSelectedStDivId:l.toString(),asSelectedUserIds:"",sIsReply:"N",attachmentFile:[],asFileName:"",asSelectedUserIdsCc:"",asSelectedStDivIdCc:"",asIsSoftwareCordinatorCc:"",asDisplayTextCc:""};Q(!0),et.SendMessage(ms).then(Se=>{Se.status===200&&(Q(!1),xe(!1))}).catch(Se=>{V.error("Message did not sent successfully.",{toastId:"error1"}),Q(!1),xe(!1)})},gs=e=>{if(e){j.map(B=>B.Is_ResultGenrated).filter(B=>B!=="Y").length;const h={asSchoolId:o,asAcademicYrId:r,asStandardDivision_Id:Number(l),asInsertedById:Number(re)},I=de>0?`Result of ${de} students is not generated. Once you publish the result, it will be visible to parents/students. Are you sure you want to continue?`:"Once you publish the result it will be visible to parents/students. Are you sure you want to continue?";g({title:"Please Confirm",message:I,variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{b()},onConfirm:()=>{b(),g({title:"Please Confirm",message:"Do you want to send a message to the students?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{b()},onConfirm:()=>{t(w(y)),t(Zs(h)),fs(),b()}})}})}};return a.useEffect(()=>{W!==""&&(V.success(W),t(_s()),t(P(F)),t(w(y)),t(E(_)))},[S,x,W,A,$]),a.useEffect(()=>{J!==""&&(V.success(J),t(Bs()),t(P(F)),t(w(y)),t(E(_)))},[S,x,J,A,$]),a.useEffect(()=>{q!==""&&(V.success(q),t(Es()),t(P(F)),t(w(y)),t(E(_)))},[S,x,q,A]),a.useEffect(()=>{l!="0"&&(t(Ls(We)),t(Ms(Je)),t(E(_)),t(Us(Ke)),t($s(Qe)),t(P(F)))},[S,x,l,A,$]),a.useEffect(()=>{t(E(_))},[l]),a.useEffect(()=>{t(w(y))},[l]),s.jsxs(L,{sx:{px:2},children:[s.jsx(Vs,{navLinks:[{title:"Final Result",path:""}],rightActions:s.jsxs(Ys,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"left",gap:1,sx:{mt:{xs:0,sm:0},flexWrap:{xs:"nowrap",sm:"nowrap"}},children:[s.jsx(Ie,{item:!0,xs:12,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:s.jsx(Hs,{sx:{width:{xs:"70vw",sm:"20vw"},bgcolor:G==="N"&&v.length==2?"#F0F0F0":"inherit"},ItemList:v,onChange:ts,label:"Teacher",defaultValue:l,DisableClearable:G==="N"&&v.length==2,disabled:G==="N"&&v.length==2,mandatory:!0,size:"small"})}),s.jsxs(Ie,{item:!0,xs:12,sm:12,gap:1,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-end"},children:[s.jsx(N,{title:'Display student list for their result generation. Click on "Generate All" to generate final results for all the students in the selected class. Click on "Publish" to publish the final result of the selected class. Click on "Publish All" to publish the final results of all the classes in your school.',children:s.jsx(C,{sx:{color:"white",backgroundColor:Ce[500],"&:hover":{backgroundColor:Ce[600]}},children:s.jsx(zs,{})})}),s.jsx(N,{title:"Generate All",disableHoverListener:!1,disableFocusListener:!1,children:s.jsx("span",{children:s.jsx(C,{onClick:hs,disabled:U==!1||c==!0||u,sx:{color:"white",backgroundColor:c?m[200]:m[500],"&:hover":{backgroundColor:m[600]},...(U==!1||c==!0||u)&&{pointerEvents:"none"}},children:s.jsx(ve,{})})})}),s.jsx(N,{title:"View Result All",disableHoverListener:!1,disableFocusListener:!1,children:s.jsx("span",{children:s.jsx(C,{onClick:()=>{R("/RITeSchool/Teacher/ViewResultAll/"+f(l),{state:{fromInternal:!0}})},disabled:(d==null?void 0:d.AllowPublish)==!1||u,sx:{color:"white",backgroundColor:(d==null?void 0:d.AllowPublish)==!1?m[200]:m[500],"&:hover":{backgroundColor:m[600]},...((d==null?void 0:d.AllowPublish)==!1||u)&&{pointerEvents:"none"}},children:s.jsx(Te,{})})})}),Be.CanPublishUnpublishExam==!0&&s.jsxs(s.Fragment,{children:[s.jsx(N,{title:"Publish",disableHoverListener:!1,disableFocusListener:!1,children:s.jsx("span",{children:s.jsx(C,{onClick:()=>gs(!0),disabled:c==!0||d.AllowPublish==!1||ce||u,sx:{color:"white",backgroundColor:c==!0||d.AllowPublish==!1||ce||u?m[200]:m[500],"&:hover":{backgroundColor:m[600]},...(c==!0||d.AllowPublish==!1||u)&&{pointerEvents:"none"}},children:s.jsx(Os,{})})})}),s.jsx(N,{title:"Unpublish",disableHoverListener:!1,disableFocusListener:!1,children:s.jsx("span",{children:s.jsx(C,{onClick:rs,disabled:!c||u,sx:{color:"white",backgroundColor:c?X[500]:X[200],"&:hover":{backgroundColor:X[600]},...(!c||u)&&{pointerEvents:"none"}},children:s.jsx(qs,{})})})})]}),_e==!0&&s.jsx(N,{title:"Toppers",disableHoverListener:!1,disableFocusListener:!1,children:s.jsx("span",{children:s.jsx(C,{onClick:os,disabled:c==!1&&d.AllowPublish==!1||u,sx:{color:"white",backgroundColor:m[500],"&:hover":{backgroundColor:m[600]},...(c==!1&&d.AllowPublish==!1||u)&&{pointerEvents:"none"}},children:s.jsx(Ws,{})})})})]})]})}),U==!1?s.jsx(Y,{variant:"body1",sx:{textAlign:"center",marginTop:4,backgroundColor:"#324b84",padding:1,borderRadius:2,color:"white"},children:s.jsx("strong",{children:"No exam of this class has been published for the current academic year."})}):null,j.length>0&&U==!0&&l!=="0"?s.jsxs(L,{sx:{background:"white",p:2},children:[s.jsx(Y,{variant:"h6",textAlign:"center",color:"primary",mb:2,children:Ee.IsConfiged==0?s.jsx("div",{children:ue.length>0&&s.jsx(Js,{variant:"filled",color:"info",sx:{mb:2,boxShadow:"none"},icon:s.jsx(je,{}),children:s.jsxs(Y,{variant:"h6",children:[" All configured exams are not published - ",ue.map(e=>e.SchoolWise_Test_Name).join(", ")]})})}):s.jsx("span",{children:" "})}),k>0?s.jsx("div",{style:{flex:1,textAlign:"center"},children:s.jsxs(Y,{variant:"subtitle1",sx:{margin:"16px 0",textAlign:"center"},children:[s.jsxs(L,{component:"span",fontWeight:"fontWeightBold",children:[Me," to ",he]})," ","out of"," ",s.jsx(L,{component:"span",fontWeight:"fontWeightBold",children:k})," ",k===1?"record":"records"]})}):s.jsx("span",{children:" "}),j&&j.length>0&&s.jsx(It,{columns:Fe,data:j,clickHeader:He,sortby:ge,sortAsc:K}),he>19?s.jsx(Ks,{rowsPerPage:x,ChangeRowsPerPage:cs,rowsPerPageOptions:De,PageChange:ds,pagecount:Ue}):s.jsx("span",{}),M&&s.jsx(at,{open:M,setOpen:D,ClickCloseDialogBox:is,onClickUnpublish:us,ExamName:Ge,TeacherName:ke(v,l)})]}):s.jsx("span",{})]})};export{_t as default};
