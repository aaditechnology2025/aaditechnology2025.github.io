import{u as Ke,A as Je,w as Ze,x as ee,r as o,E as qe,c as l,lG as Qe,iA as es,ns as ge,nt as ss,jS as ts,t as rs,nu as ns,j as s,B as p,n as as,F as os,m as T,p as is,G as E,bR as L,H as U,I as W,J as pe,K as ls,bv as M,ng as ds,as as be,L as Se,aJ as se,T as C,ai as X,c8 as cs,aj as v,an as A,al as x,am as a,ak as te,ii as N,ae as us,nv as re}from"./index-d5YOjbb6.js";import{R as ne}from"./ResizableTextField1-DPLma9Eu.js";import{C as ms}from"./CheckCircle-DJwARDWF.js";import{U as xs}from"./Unpublished-OD6eHjAe.js";import{S as hs}from"./Save-QCBiFkbm.js";const Is=()=>{const m=Ke(),je=Je();let{Assessment:z,YearwiseStudentId:u,StandardId:b}=Ze();z=ee(z),u=ee(u),b=ee(b);const[i,fe]=o.useState(z);console.log(i,"AssessmentId");const[Ie,Ce]=o.useState("0"),[R,B]=o.useState({}),{showAlert:ae,closeAlert:k}=o.useContext(qe),[we,ye]=o.useState("0"),[$,V]=o.useState({}),[w,oe]=o.useState(""),ie=300,[Ae,D]=o.useState(""),[Pe,H]=o.useState(""),j=Number(sessionStorage.getItem("AcademicYearId")),S=Number(localStorage.getItem("localSchoolId")),_=Number(localStorage.getItem("UserId")),le=sessionStorage.getItem("RoleId"),de=sessionStorage.getItem("Id"),ce=l(e=>e.PreprimaryProgressReport.ISAssessmentPublishStatus),f=ce.map(e=>e.AssessmentPublishStatus),d=ce.map(e=>e.StudentWiseAssessmentPublishStatus),K=l(e=>e.PreprimaryProgressReport.ISFillSubjectSections),Ge=l(e=>e.PreprimaryProgressReport.ISFillSchoolDetails),P=l(e=>e.PreprimaryProgressReport.ISFillGradeDetails),ue=l(e=>e.PreprimaryProgressReport.ISFillXseedRemarks),h=l(e=>e.PreprimaryProgressReport.ISFillNonXseedSubjectGrades),Oe=l(e=>e.PreprimaryProgressReport.ISFillStudentDetails),me=l(e=>e.PreprimaryProgressReport.ISFillStudentAttendance),Le=P.filter(e=>e.ConsideredAsAbsent!=="1"&&e.ConsideredAsExempted!=="1").sort((e,t)=>parseInt(e.SortOrder)-parseInt(t.SortOrder)),g=l(e=>e.PreprimaryProgressReport.ISFillStudentsLearningOutcomes);l(e=>e.PreprimaryProgressReport.ISGetStandardwiseAssessmentDetails);const ve=[...g].sort((e,t)=>parseInt(e.LearningOutcomeSortOrder)-parseInt(t.LearningOutcomeSortOrder)),J=l(e=>e.PreprimaryProgressReport.ISManageStudentWiseAssessmentGrades),Z=l(e=>e.PreprimaryProgressReport.ISFillStudentsLearningOutcomeObservations),Ne=l(e=>e.PreprimaryProgressReport.Loading),F=l(e=>e.PrePrimaryResult.ISlistpublishstatusDetails),G=F.length>0?F[0].IsPublished:"",O=F.length>0?F[0].PublishStatus:"",Re=l(e=>e.getSchoolSettings.getUserDetails),ke=l(e=>e.Studentwiseprogress.ISAssessmentDropdown),De=e=>e.LearningOutcomeGradeId!=="0",xe=g.map(e=>De(e)).every(e=>e);o.useEffect(()=>{const e=ue.filter(t=>t.Remark);e.length>0&&oe(e.map(t=>t.Remark))},[ue]),console.log(w,"remark");const he={asSchoolId:S,asAcademicYearId:j,asStandardDivisionId:Number(u),asYearwiseStudentId:Number(b),asAssessmentId:Number(i)},Fe={asSchoolId:S,asAcademicYearId:j,asStandardId:Number(u)},Ye={asSchoolId:S,asAcadmeicYearId:j,asStdDivId:Number(u),asAssessmentId:Number(i)},Te={asAcademicYearId:Number(j),asSchoolId:Number(S)};o.useEffect(()=>{m(Qe(Te))},[]),o.useEffect(()=>{const e={asSchoolId:String(S),asUserId:de,asRoleId:le};m(es(e))},[de,le]);const Ee=e=>{fe(e)};o.useEffect(()=>{m(ge(he))},[i,u,b]),o.useEffect(()=>{m(ss(Fe))},[u]),o.useEffect(()=>{m(ts(Ye))},[i]),o.useEffect(()=>{if(g.length>0){const e=g.reduce((t,r)=>(t[r.LearningOutcomeConfigId]=r.GradeId,t),{});B(e)}},[g]);function Ue(e){Ce(e);const t=g.reduce((r,n)=>(r[n.LearningOutcomeConfigId]=e,r),{});B(t)}const We=(e,t)=>{B(r=>({...r,[t]:e}))};o.useEffect(()=>{if(h.length>0){const e=h.reduce((t,r)=>(t[r.GradeId]=r.GradeId,t),{});V(e)}},[h]);function Me(e){ye(e);const t=h.reduce((r,n)=>(r[n.GradeId]=e,r),{});V(t)}const Xe=(e,t)=>{V(r=>({...r,[t]:e}))};function q(){let e="";return g.forEach(t=>{const r=t.LearningOutcomeConfigId,n=R[r],c=t.SubjectSectionConfigId,Y=Z.filter(I=>I.SubjectSectionConfigId===c).map(I=>I.LearningOutcomesObservationId)[0],y=K.filter(I=>I.SubjectSectionConfigId===c).map(I=>t.LearningOutcomeGradeId)[0];e+=`<LearningOutcomes GradeId='${n}' Observation='' LearningOutcomesObservationId='${Y}' SubjectSectionConfigurationId='${c}' LearningOutcomeConfigId='${r}' LearningOutcomeGradeId='${y}' />`}),e=`<LearningOutcomes>${e}</LearningOutcomes>`,e}function Q(){let e="";return h.forEach(t=>{const r=t.GradeId,n=$[r],c=t.SubjectId;e+=`<NonXseedSubjectGrades  GradeId='${n}' Observation='' SubjectId='${c}'/>`}),e=`<NonXseedSubjectGrades>${e}</NonXseedSubjectGrades>`,e}const ze=e=>{e.target.value.length<=ie&&oe(e.target.value)},Be=()=>{let e=!1;const t=g.filter(n=>R[n.LearningOutcomeConfigId]=="0"),r=h.filter(n=>$[n.GradeId]=="0");if(t.length>0){const n=K.map(c=>{const Y=g.filter(y=>y.SubjectSectionConfigId===c.SubjectSectionConfigurationId&&R[y.LearningOutcomeConfigId]==="0");if(Y.length>0){const y=Y.map((I,_e)=>_e+1).join(", ");return`${c.SubjectSectionName} : ${y}`}return null}).filter(Boolean);if(n.length>0){const c=n.join(`.
`);D(`Grade should be selected for Learning Outcome(s): ${c}`),e=!0}else D("")}else D("");if(r.length>0){const n=h.map(c=>c.SubjectName).join(", ");H(`Grade should be selected for co-curricular subject(s): ${n}`),e=!0}else H("");if(!e){const n={asSchoolId:S,asAcademicYearId:j,asYearwiseStudentId:Number(b),asStandardDivisionId:Number(u),asAssessmentId:Number(i),asInsertedById:_,asLearningOutcomeXML:q(),asXseedGradesXML:Q(),asMode:"Save",asRemark:w};m(re(n))}},$e=()=>{const e={asSchoolId:S,asAcademicYearId:j,asYearwiseStudentId:Number(b),asStandardDivisionId:Number(u),asAssessmentId:Number(i),asInsertedById:_,asLearningOutcomeXML:q(),asXseedGradesXML:Q(),asMode:"Publish",asRemark:w};ae({title:"Please Confirm",message:"Once you publish the result it will be visible to parents/student. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{k()},onConfirm:()=>{m(re(e)),k()}})},Ve=()=>{const e={asSchoolId:S,asAcademicYearId:j,asYearwiseStudentId:Number(b),asStandardDivisionId:Number(u),asAssessmentId:Number(i),asInsertedById:_,asLearningOutcomeXML:q(),asXseedGradesXML:Q(),asMode:"Unpublish",asRemark:w};ae({title:"Please Confirm",message:"Once you unpublish the result it will not be visible to parents/student. Are you sure you want to continue?",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onCancel:()=>{k()},onConfirm:()=>{m(re(e)),k()}})},He=()=>{je("/RITeSchool/Teacher/PreprimaryProgressReportView/"+T(i)+"/"+T(u)+"/"+T(b),{state:{fromInternal:!0}})};return o.useEffect(()=>{J!=""&&(rs.success(J),m(ns()),m(ge(he)),D(""),H(""))},[J]),s.jsxs(p,{sx:{px:2},children:[Ne&&s.jsx(as,{}),s.jsx(os,{navLinks:[{title:"Student Wise Progress Report ",path:"/RITeSchool/Teacher/StudentwiseProgressReport/"+T(i)},{title:"Progress Report",path:"/RITeSchool/Teacher/PreprimaryProgressReport"}],rightActions:s.jsx(s.Fragment,{children:s.jsxs(is,{direction:{xs:"column",sm:"row"},justifyContent:"space-between",alignItems:"left",gap:1,sx:{mt:{xs:0,sm:0},flexWrap:{xs:"nowrap",sm:"nowrap"}},children:[s.jsx(E,{item:!0,xs:12,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:s.jsx(L,{sx:{width:{xs:"50vw",sm:"20vw",md:"15vw"}},ItemList:ke,onChange:Ee,label:"Assessment",defaultValue:i,size:"small"})}),s.jsxs(E,{item:!0,xs:12,gap:1,display:"flex",justifyContent:{xs:"flex-start",sm:"flex-start"},children:[s.jsx(U,{title:"Assign, publish student grades and view students progress report.",children:s.jsx(W,{sx:{color:"white",backgroundColor:pe[500],height:"36px !important",":hover":{backgroundColor:pe[600]}},children:s.jsx(ls,{})})}),s.jsx(U,{title:"View Progress Report",children:s.jsx("span",{children:s.jsx(W,{sx:{color:"white",backgroundColor:M[500],"&:hover":{backgroundColor:M[600]}},disabled:d=="N"||xe==!1||i=="",onClick:He,children:s.jsx(ds,{})})})}),Re.CanPublishUnpublishExam==!0&&s.jsx(U,{title:d[0]=="N"?"Publish":"Unpublish",children:s.jsx("span",{children:s.jsx(W,{sx:{color:"white",backgroundColor:d[0]=="N"?M[500]:be[500],"&:hover":{backgroundColor:d[0]=="N"?M[600]:be[600]}},disabled:f[0]=="Y"||xe==!1||i=="",onClick:d[0]=="N"?$e:Ve,children:d[0]=="N"?s.jsx(ms,{}):s.jsx(xs,{})})})}),s.jsx(U,{title:"Save",children:s.jsx("span",{children:s.jsx(W,{onClick:Be,sx:{color:"white",backgroundColor:Se[500],height:"36px !important",":hover":{backgroundColor:Se[600]}},disabled:f=="Y"||d=="Y"||i=="",children:s.jsx(hs,{})})})})]})]})})}),s.jsx(se,{Error:Ae}),s.jsx(se,{Error:Pe}),i==""&&s.jsx(se,{Error:"Assessment should be selected."}),i!==""&&s.jsxs(p,{border:"1px solid grey",mb:4,sx:{px:2,background:"white"},children:[s.jsx(p,{sx:{pt:2,background:"white"},children:s.jsx(E,{container:!0,spacing:3,children:Ge.map(e=>s.jsx(E,{item:!0,xs:12,children:s.jsxs(p,{sx:{backgroundColor:"#F0F0F0",textAlign:"center",borderLeft:"1px solid grey",borderRight:"1px solid grey"},children:[s.jsx("hr",{}),s.jsx(C,{variant:"h4",textAlign:"center",color:"#38548a",mb:0,children:e.OrganizationName}),s.jsx("hr",{}),s.jsx(C,{variant:"h4",textAlign:"center",color:"#38548a",mb:0,children:e.School_Name}),s.jsx("hr",{}),s.jsx(C,{variant:"h4",textAlign:"center",color:"#38548a",mb:0,children:"Progress Report"}),s.jsx("hr",{})]})}))})}),s.jsx(X,{component:cs,sx:{maxWidth:"100%",overflowX:"auto"},children:s.jsx(v,{children:s.jsx(A,{children:Oe.map((e,t)=>s.jsxs(x,{sx:{bgcolor:"#38548A",display:"flex",flexWrap:"nowrap"},children:[s.jsx(a,{sx:{flex:"0 0 100px",minWidth:"100px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Roll No :  ",e.RollNo," "]})}),s.jsx(a,{sx:{flex:"0 0 300px",minWidth:"300px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Name :  ",e.StudentName," "]})}),s.jsx(a,{sx:{flex:"1 1 auto",minWidth:"100px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Class :  ",e.Class," "]})}),s.jsx(a,{sx:{flex:"1 1 auto",minWidth:"100px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Year :  ",e.AcademicYear," "]})}),s.jsx(a,{sx:{flex:"1 1 auto",minWidth:"200px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Assessment : ",e.Assessment," "]})}),s.jsx(a,{sx:{flex:"1 1 auto",minWidth:"200px",textAlign:"left",whiteSpace:"nowrap",color:"white",fontSize:{xs:"0.8rem",sm:"0.9rem"}},children:s.jsxs("b",{children:["Attendance :  ",me.filter(r=>r.YearwiseStudentId==e.YearWiseStudentId&&r.IsPresent=="true").length," / ",me.filter(r=>r.YearwiseStudentId==e.YearWiseStudentId).length," "]})})]},t))})})}),s.jsxs("div",{children:[s.jsx(C,{variant:"h4",textAlign:"left",color:"#38548a",mt:2,children:"Key to Curricular and Co-Curricular"}),s.jsx(X,{component:p,children:s.jsxs(v,{"aria-label":"simple table",sx:{border:"1px solid lightgrey"},children:[s.jsx(te,{children:s.jsxs(x,{sx:{background:e=>e.palette.secondary.main,color:e=>e.palette.common.white},children:[s.jsx(a,{sx:{textTransform:"capitalize",color:e=>e.palette.common.white,py:1},children:"Grade"}),s.jsx(a,{sx:{textTransform:"capitalize",color:e=>e.palette.common.white,py:1},children:"Description"})]})}),s.jsx(A,{children:Le.map(e=>s.jsxs(x,{children:[s.jsx(a,{sx:{py:1},children:e.Name}),s.jsx(a,{sx:{py:1},children:e.Description})]},e.GradeId))})]})}),s.jsx(p,{mt:1,children:s.jsx(v,{"aria-label":"simple table",sx:{border:"1px solid lightgrey"},children:s.jsx(A,{children:s.jsx(x,{sx:{bgcolor:"#F0F0F0",border:"1px solid lightgrey"},children:s.jsxs(a,{sx:{textAlign:"left",py:1,color:"black",p:1},children:[s.jsx("b",{children:"Note :  "})," Ab - Absent        Ex - Exempted "]})})})})})]}),s.jsxs(s.Fragment,{children:[s.jsx(C,{variant:"h4",textAlign:"left",color:"#38548a",mt:2,children:"Pre-Primary Curricular Subjects"}),s.jsx(X,{component:p,sx:{border:"1px solid lightgrey"},children:s.jsxs(v,{"aria-label":"simple table",children:[s.jsx(te,{children:s.jsxs(x,{sx:{background:e=>e.palette.secondary.main,color:e=>e.palette.common.white},children:[s.jsx(a,{align:"left",sx:{color:e=>e.palette.common.white,py:1},children:"Sr. No."}),s.jsx(a,{align:"left",sx:{color:e=>e.palette.common.white,py:1},children:"Learning Outcome"}),s.jsx(a,{sx:{textTransform:"capitalize",backgroundColor:e=>e.palette.secondary.main,color:"white",pt:"10px",pb:"10px"},children:s.jsx(L,{ItemList:P,defaultValue:Ie,label:"",sx:{maxWidth:"20vw",backgroundColor:"white",marginLeft:"5px"},size:"small",DisableClearable:!0,onChange:Ue,mandatory:!0,disabled:d=="Y"&&f=="N"||G=="Y"&&O=="Y"})}),N()&&s.jsx(a,{sx:{color:e=>e.palette.common.white,py:1},children:"Facilitator's Observation"})]})}),s.jsx(A,{children:K.map(e=>s.jsxs(us.Fragment,{children:[s.jsx(x,{sx:{backgroundColor:"#F0F0F0",alignItems:"center"},children:s.jsx(a,{sx:{py:1.5,fontWeight:"bold"},colSpan:4,children:e.SubjectSectionName})}),ve.filter(t=>t.SubjectSectionConfigId===e.SubjectSectionConfigurationId).map((t,r)=>s.jsxs(x,{children:[s.jsx(a,{sx:{py:1},children:r+1}),s.jsx(a,{sx:{py:1},children:t.LearningOutcome}),s.jsx(A,{children:t.SubjectSectionConfigId===e.SubjectSectionConfigurationId&&s.jsx(x,{children:s.jsx(a,{sx:{py:1},children:s.jsx(L,{ItemList:P,defaultValue:R[t.LearningOutcomeConfigId],label:"",sx:{width:"20vw",backgroundColor:"white"},size:"small",DisableClearable:!0,onChange:n=>We(n,t.LearningOutcomeConfigId),mandatory:!0,disabled:d=="Y"&&f=="N"||G=="Y"&&O=="Y"},t.LearningOutcomeConfigId)})})}),N()&&s.jsx(a,{sx:{color:n=>n.palette.common.white,py:1},children:Z.find(n=>n.SubjectSectionConfigId===e.SubjectSectionConfigurationId)?s.jsx(ne,{rows:1,value:Z.find(n=>n.SubjectSectionConfigId===e.SubjectSectionConfigurationId).Observation,disabled:!0,fullWidth:!0,sx:{width:"100%"}}):s.jsx("span",{})})]},t.YearwiseStudentId))]},e.SubjectSectionConfigurationId))})]})})]}),h.length>0?s.jsxs("div",{children:[s.jsx(C,{variant:"h4",textAlign:"left",color:"#38548a",mt:2,children:N()?" Curricular Subjects":"  Co-Curricular Subjects"}),s.jsx(X,{component:p,children:s.jsxs(v,{"aria-label":"simple table",sx:{border:"1px solid lightgrey"},children:[s.jsx(te,{children:s.jsxs(x,{sx:{background:e=>e.palette.secondary.main,color:e=>e.palette.common.white},children:[s.jsx(a,{sx:{textTransform:"capitalize",color:e=>e.palette.common.white,py:1},children:s.jsx(s.Fragment,{children:" Subject"})}),s.jsx(a,{sx:{textTransform:"capitalize",backgroundColor:e=>e.palette.secondary.main,color:"white",pt:"10px",pb:"10px"},children:s.jsx(L,{ItemList:P,defaultValue:we,label:"",sx:{maxWidth:"20vw",backgroundColor:"white"},size:"small",DisableClearable:!0,onChange:Me,mandatory:!0,disabled:d=="Y"&&f=="N"||G=="Y"&&O=="Y"})}),N()&&s.jsx(s.Fragment,{children:s.jsx(a,{sx:{textTransform:"capitalize",color:e=>e.palette.common.white,py:1},children:s.jsx(s.Fragment,{children:"Facilitator's Observation"})})})]})}),s.jsx(A,{children:h.map(e=>s.jsxs(x,{children:[s.jsx(a,{sx:{py:1},children:e.SubjectName}),s.jsx(a,{children:s.jsx(L,{ItemList:P,defaultValue:$[e.GradeId],label:"",sx:{width:"20vw",backgroundColor:"white"},size:"small",DisableClearable:!0,onChange:t=>Xe(t,e.GradeId),mandatory:!0,disabled:d=="Y"&&f=="N"||G=="Y"&&O=="Y"},e.GradeId)},e.GradeId),N()&&s.jsx(s.Fragment,{children:s.jsx(a,{sx:{textTransform:"capitalize",color:t=>t.palette.common.white,py:1,width:"100%"},children:s.jsx(ne,{rows:1,value:e.Observation,fullWidth:!0,disabled:!0,sx:{width:"100%"}})})})]},e.YearwiseStudentId))})]})})]}):null,s.jsxs(p,{sx:{mt:2},children:[s.jsx(ne,{label:s.jsx("div",{children:"Remark "}),multiline:!0,value:w,onChange:ze,fullWidth:!0,disabled:d=="Y"&&f=="N"||G=="Y"&&O=="Y"}),s.jsxs(C,{variant:"caption",align:"right",display:"block",color:"textSecondary",children:["(",ie-w.length," )"]})]})]})]})};export{Is as default};
