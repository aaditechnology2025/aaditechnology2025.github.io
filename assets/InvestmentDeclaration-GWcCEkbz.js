import{r,j as e,c8 as z,B as c,ai as ie,aj as le,ak as ce,al as R,am as u,an as de,bh as me,q as he,T as i,u as X,A as xe,c as S,mX as T,h as ue,bt as pe,E as Ie,t as W,mY as ge,fl as be,mZ as ve,m_ as je,F as fe,H as U,I as G,L,bA as Se,G as p,bR as De,m$ as ye,n0 as Ae}from"./index-d5YOjbb6.js";import Ce from"./InvestmentDetailsDocument-BiUeS8Qs.js";import{T as ke}from"./TablePagination-89YK3d58.js";import{Q as we}from"./QuestionMark-C2Y4lgD8.js";import{S as Te}from"./Save-QCBiFkbm.js";import"./SingleFile-BT4Sw5XK.js";import"./CloudUpload-DJN1zp2n.js";import"./Errormessage-RPRSgLGN.js";import"./Visibility-C0VMNowd.js";import"./KeyboardArrowRight-BUZa0tnJ.js";const H=r.createContext(),Ne=({columns:j,data:v,changeText:m,GroupAmount:A=0,isLoading:k=!1,isPagination:I=!0})=>{const[h,D]=r.useState(0),[g,d]=r.useState(5),[b,y]=r.useState(v);let f=r.useContext(H);r.useEffect(()=>{y(v.map(n=>({...n,Amount:n.Amount||""})))},[v]);const F=(n,a)=>{D(a)},N=n=>{d(parseInt(n.target.value,10)),D(0)},x=(n,a)=>{let s=n.target.value;s.length>7&&(s=s.slice(0,7)),s=parseFloat(s)||"";const o=b.map((C,E)=>E===a?{...C,Amount:s}:C);y(o),m(o)},l=b.reduce((n,a)=>n+(a.Amount||0),0);return e.jsxs(z,{children:[e.jsx(c,{sx:{overflow:"auto"},children:e.jsx(ie,{component:z,children:e.jsxs(le,{sx:{tableLayout:"fixed",minWidth:600,border:n=>`1px solid ${n.palette.grey[300]}`},"aria-label":"simple table",children:[e.jsx(ce,{children:e.jsxs(R,{sx:{background:n=>n.palette.secondary.main,color:n=>n.palette.common.white},children:[e.jsx(u,{align:"center",sx:{py:1,position:"sticky",top:0,color:"white",zIndex:1e3},children:e.jsx("strong",{children:"No."})}),j.map(n=>r.createElement(u,{...n.headerCellProps,key:n.id,sx:{py:1,position:"sticky",top:0,color:"white",zIndex:1e3}},e.jsx("strong",{children:n.renderHeader?n.renderHeader():n.label}))),e.jsx(u,{sx:{py:1,position:"sticky",top:0,color:"white",zIndex:1e3},children:e.jsx("strong",{children:"Amount"})})]})}),e.jsxs(de,{children:[k?e.jsx(R,{children:e.jsx(u,{colSpan:j.length+2,align:"center",sx:{py:.5},children:e.jsx(me,{})})}):b.length===0?e.jsx(R,{children:e.jsx(u,{colSpan:j.length+2,align:"center",sx:{py:.5},children:"No data available"})}):(I?b.slice(h*g,h*g+g):b).map((n,a)=>e.jsxs(R,{children:[e.jsx(u,{align:"center",sx:{py:.5},children:h*g+a+1}),j.map((s,o)=>e.jsx(e.Fragment,{children:A==0?r.createElement(u,{sx:{py:.7},...s.cellProps,key:s.id},s.renderCell?s.renderCell(n,a):n[s.id]):e.jsx(e.Fragment,{children:o!=2&&r.createElement(u,{sx:{py:.7},...s.cellProps,key:s.id},s.renderCell?s.renderCell(n,a):n[s.id])})})),A!=0&&a%100===0&&e.jsx(u,{rowSpan:b.filter(s=>s.GroupAmount===n.GroupAmount).length,align:"center",sx:{border:s=>`1px solid ${s.palette.divider}`,py:.7},children:A}),e.jsx(u,{sx:{py:.5},children:e.jsx(he,{size:"small",value:n.Amount||"",onChange:s=>x(s,a),sx:{backgroundColor:f==="True"?"#F0F0F0":"white","& .MuiInputBase-input":{cursor:f==="True"?"default":"text",textAlign:"right"}},autoComplete:"off",InputProps:{readOnly:f==="True"}})})]},a)),e.jsxs(R,{children:[e.jsx(u,{colSpan:j.length+1,sx:{textAlign:"right",py:.5},children:e.jsx(i,{variant:"h6",sx:{backgroundColor:"#324b84",p:.5,color:"white",textAlign:"right",pr:2,width:"120px",marginLeft:"auto"},children:"Total Amount"})}),e.jsx(u,{sx:{py:.5},children:e.jsx(i,{variant:"h6",sx:{backgroundColor:"#324b84",p:.5,color:"white",textAlign:"center",width:"140px"},children:l})})]})]})]})})}),I&&e.jsx(ke,{component:"div",count:b.length,rowsPerPage:g,page:h,onPageChange:F,onRowsPerPageChange:N})]})},Re=({refreshData:j,clickDocumentDetails:v})=>{const m=X();xe();const A=Number(localStorage.getItem("localSchoolId")),k=Number(localStorage.getItem("UserId"));sessionStorage.getItem("FinancialYearId");const[I,h]=r.useState([]),[D,g]=r.useState([]);r.useState(0);const d=S(x=>x.InvestmentDeclaration.ISlistInvestmentDetails),y=S(x=>x.InvestmentDeclaration.ISNewGetInvestmentDetails)||[],f={asSchoolId:A,asFinancialYearId:1,asUserId:k};r.useEffect(()=>{m(T(f))},[]),r.useEffect(()=>{h(d)},[d]),r.useEffect(()=>{g(d)},[d]);const F=(x,l)=>{h(n=>n.map(a=>{if(a.SectionId===l){const s=x.find(o=>o.Id===a.Id);if(s)return{...a,Amount:s.Amount}}return a})),j(n=>n.map(a=>{if(a.SectionId===l){const s=x.find(o=>o.Id===a.Id);if(s)return{...a,Amount:s.Amount}}return a}))},N=()=>(y.map(l=>I.filter(a=>a.SectionId===l.Id).reduce((a,s)=>a+(s.Amount||0),0)).reduce((l,n)=>l+n,0),y.map(l=>{const n=I.filter(o=>o.SectionId===l.Id);if(n.length===0)return null;n.reduce((o,C)=>o+(C.Amount||0),0);const a=o=>{v(o)},s=[{id:"Name",label:l.Name,renderCell:o=>o.Name},{id:"AttachmentCount",label:"Attachment Count",headerCellProps:{align:"center"},cellProps:{align:"center"},renderCell:o=>e.jsxs("div",{onClick:()=>a(o),style:{cursor:"pointer",color:"#428bca",padding:"3px 8px",margin:"0px 15px"},children:[" ",o.DocumentCount]})},{id:"MaximumLimit",label:"Maximum Limit Rs.",headerCellProps:{align:"center"},cellProps:{align:"center",sx:{border:o=>`1px solid ${o.palette.divider}`}},renderCell:o=>l.GroupMaxAmount==0?o.MaxAmount:l.GroupMaxAmount}];return e.jsx(e.Fragment,{children:e.jsx(c,{sx:{background:"white",pt:2,pb:2},children:e.jsx(Ne,{columns:s,data:n,isLoading:!1,isPagination:!1,GroupAmount:l.GroupMaxAmount,changeText:o=>F(o,l.Id)})},l.Id)})}));return e.jsx(c,{sx:{width:1},children:N()})},We=()=>{var B,Y,O;const j=ue(),v=pe(j.breakpoints.down("sm")),m=X(),{showAlert:A,closeAlert:k}=r.useContext(Ie),I=Number(localStorage.getItem("localSchoolId")),h=Number(localStorage.getItem("UserId"));sessionStorage.getItem("FinancialYearId"),r.useState([]),r.useState("");const D=S(t=>t.InvestmentDeclaration.ISlistInvestmentDetails);S(t=>t.InvestmentDeclaration.ISlistInvestmentAmountDetails);const g=S(t=>t.InvestmentDeclaration.ISSubmitInvestmentDeclaration),d=S(t=>t.InvestmentDeclaration.ISlistInvestmentEmpDetails),b=d.map(t=>t.IsSubmitted),[y,f]=r.useState("0"),N=S(t=>t.InvestmentDeclaration.ISNewGetInvestmentDetails)||[],x=S(t=>t.InvestmentDeclaration.ISGetRegimeDropdown),l=S(t=>t.InvestmentDeclaration.ISSaveInvestment),n={asSchoolId:I,asFinancialYearId:1,asUserId:h},a={asSchoolId:I,asFinancialYearId:1,asUserId:h},s={asSchoolId:I},[o,C]=r.useState([]),E=()=>{const t={asSchoolId:I,asFinancialYearId:1,asUpdatedById:h,asUserId:h,asDeclarationXML:$(),asRegimeId:Number(y)};m(ye(t)),m(T(n))};r.useEffect(()=>{l!=""&&(W.success(l),m(ge()),m(T(n)))},[l]);const V=()=>{const t={asSchoolId:I,asFinancialYearId:1,asUserId:h,asUpdatedById:h};A({title:"Please Confirm",message:"After submission you will not be able to update any details. Do you want to continue? ",variant:"warning",confirmButtonText:"Confirm",cancelButtonText:"Cancel",onConfirm:()=>{k(),m(Ae(t))},onCancel:k})};r.useEffect(()=>{g!=""&&(W.success(g),m(be()),m(T(n)))},[g]);function $(){let t=`\r
<ArrayOfInvestmentDeclaration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">\r
 >`;return o.map(w=>{w.Amount!=""&&(t+="<InvestmentDeclaration><Id>0</Id><InvestmentMethodId>"+w.Id+"</InvestmentMethodId><UserId>0</UserId><Amount>"+w.Amount+"</Amount><IsDocSubmitted>false</IsDocSubmitted><SectionId>0</SectionId><SortOrder>0</SortOrder><DocumentCount>0</DocumentCount><RegimId>0</RegimId></InvestmentDeclaration>")}),t+=`\r
</ArrayOfInvestmentDeclaration>`,t}const Q=N.map(t=>o.filter(P=>P.SectionId===t.Id).reduce((P,oe)=>P+(oe.Amount||0),0)).reduce((t,w)=>t+w,0);r.useEffect(()=>{m(ve(s))},[]),r.useEffect(()=>{x.length>0&&d.length>0&&(d[0].RegimeId!=="0"?f(d[0].RegimeId):f(x[0].Value))},[x,d]),r.useEffect(()=>{m(T(n))},[]),r.useEffect(()=>{m(je(a))},[]);const q=sessionStorage.getItem("StudentName");r.useEffect(()=>{D.length>0&&C(D)},[D]);const J=t=>{f(t)},Z=t=>{C(t)},[_,M]=r.useState(!1),[K,ee]=r.useState(null),[te,ne]=r.useState(""),se=t=>{ee(t.Id),ne(t.Name),M(!0)},ae=()=>{m(T(n))},re=t=>{M(!1)};return e.jsx(e.Fragment,{children:e.jsxs(c,{sx:{px:2},children:[e.jsx(fe,{navLinks:[{title:"Investment Declaration",path:"/RITeSchool/Teacher/InvestmentDeclaration"}],rightActions:e.jsxs(e.Fragment,{children:[e.jsx(c,{children:e.jsx(U,{title:"Submit investment details for income tax calculation.",children:e.jsx(G,{sx:{bgcolor:"grey.500",color:"white","&:hover":{bgcolor:"grey.600"}},children:e.jsx(we,{})})})}),e.jsx(c,{children:e.jsx(U,{title:"Save",children:e.jsx("span",{children:e.jsx(G,{sx:{backgroundColor:L[500],color:"white","&:hover":{backgroundColor:L[600]}},onClick:E,disabled:((B=d[0])==null?void 0:B.IsSubmitted)=="True",children:e.jsx(Te,{})})})})}),e.jsx(c,{children:e.jsx(U,{title:"Submit",children:e.jsx("span",{children:e.jsx(G,{disabled:!(((Y=d[0])==null?void 0:Y.IsSaved)=="True"&&((O=d[0])==null?void 0:O.IsSubmitted)=="False"),sx:{backgroundColor:L[500],color:"white","&:hover":{backgroundColor:L[600]}},onClick:V,children:e.jsx(Se,{})})})})})]})}),e.jsx(Ce,{Id:K,UserName:d.length>0?d[0].UserName:q,DocumentName:te,open:_,handleClose:re,RefreshList:ae}),e.jsxs(c,{border:1,sx:{p:2,background:"white"},children:[e.jsx(p,{container:!0,spacing:3,children:d.map(t=>e.jsxs(p,{item:!0,xs:12,children:[e.jsxs(c,{sx:{backgroundColor:"#F0F0F0",textAlign:"center",marginBottom:2},children:[e.jsx("hr",{}),e.jsx(i,{variant:"h4",textAlign:"center",color:"#38548a",mb:1,children:t.SchoolName}),e.jsx("hr",{}),e.jsx(i,{variant:"h4",textAlign:"center",color:"#38548a",mb:1,children:t.SchoolAddress}),e.jsx("hr",{}),e.jsxs(i,{variant:"h4",textAlign:"center",color:"#38548a",mb:1,children:["INVESTMENT DECLARATION FORM FOR FINANCIAL YEAR"," ",t.FinancialYear]}),e.jsx("hr",{})]}),e.jsxs(p,{container:!0,spacing:2,mb:2,children:[e.jsx(p,{item:!0,xs:12,sm:8,children:e.jsxs(i,{variant:"h5",children:[e.jsx(c,{display:"inline-block",border:1,borderRadius:40,pl:1,pr:7,mr:1,component:"span",children:"Name :"}),e.jsx(i,{variant:"body1",component:"span",children:t.UserName})]})}),e.jsx(p,{item:!0,xs:12,sm:4,children:e.jsxs(i,{variant:"h5",children:[e.jsx(c,{display:"inline-block",border:1,borderRadius:4,pl:1,pr:2.5,mr:1,component:"span",children:"Employee No :"}),e.jsx(i,{variant:"body1",component:"span",children:t.EmployeeNo})]})}),e.jsx(p,{item:!0,xs:12,sm:8,children:e.jsxs(i,{variant:"h5",display:"flex",alignItems:"center",children:[e.jsx(c,{display:"inline-block",border:1,borderRadius:4,pl:1,pr:5.5,mr:1,component:"span",sx:{textWrap:"nowrap"},children:"Address :"}),e.jsx(i,{variant:"body1",component:"span",sx:{textWrap:"wrap",maxWidth:"auto"},children:t.Address})]})}),e.jsx(p,{item:!0,xs:12,sm:4,children:e.jsxs(i,{variant:"h5",children:[e.jsx(c,{display:"inline-block",border:1,borderRadius:4,pl:1,pr:3.5,mr:1,component:"span",children:"Designation :"}),e.jsx(i,{variant:"body1",component:"span",children:t.Designation})]})}),e.jsx(p,{item:!0,xs:12,sm:8,children:e.jsxs(i,{variant:"h5",children:[e.jsx(c,{display:"inline-block",border:1,borderRadius:4,pl:1,pr:6,mr:1,component:"span",children:"PAN No :"}),e.jsx(i,{variant:"body1",component:"span",children:t.PanNo})]})}),e.jsx(p,{item:!0,xs:12,sm:4,children:e.jsxs(i,{variant:"h5",children:[e.jsx(c,{display:"inline-block",border:1,borderRadius:4,pl:1,pr:6.8,mr:1,component:"span",children:"Gender :"}),e.jsx(i,{variant:"body1",component:"span",children:t.Gender})]})})]}),e.jsx(c,{children:e.jsx(De,{sx:{maxWidth:{xs:"100%",sm:"50%",md:"30%",lg:"15vw"}},ItemList:x,onChange:J,label:"Regime",defaultValue:y,size:"small"})}),e.jsx(c,{children:D.length>0&&e.jsx(p,{container:!0,sx:{maxWidth:"100%"},children:e.jsx(H.Provider,{value:b.length>0?b[0]:"",children:e.jsx(Re,{clickDocumentDetails:se,refreshData:Z})})})})]},t.UserId))}),e.jsxs(c,{sx:{pl:v?1:2,pr:v?1:2},children:[e.jsxs(c,{sx:{mt:0,pl:0,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-center",textAlign:"center",width:"100%"},children:[e.jsx(i,{variant:"h6",sx:{color:"white",backgroundColor:"#38548a",p:.5,mr:1.5,mb:0,ml:{lg:"42%",xs:"auto"},textAlign:"center"},children:"Grand Total"}),e.jsx(i,{sx:{backgroundColor:"#38548a",color:"white",p:.5,ml:2,textAlign:"center"},children:Q})]}),e.jsx(p,{container:!0,spacing:v?2:3,children:d.map(t=>e.jsx(p,{item:!0,xs:12,children:e.jsxs(c,{sx:{backgroundColor:"#ffffff",mt:2,p:2,borderRadius:1,boxShadow:1},children:[e.jsxs(i,{variant:"body1",paragraph:!0,children:["I further undertake to provide all documentary proofs of payment made by me before 25th January,"," ",t.FinancialYearEnd,", and if I fail to do so, the school can make full deduction of income tax dues from February / March ",t.FinancialYearEnd," salary."]}),e.jsx(i,{variant:"body1",paragraph:!0,children:"I hereby declare that the information stated above is true and correct. I also authorize the School to recover tax (TDS) from my salary based on the declaration/documents submitted by me. I am personally liable to Income Tax proceedings for any misstatements in the declaration or proofs submitted herewith if they are inconsistent with the requirement of the Income Tax Act, 1961."}),e.jsxs(i,{variant:"body1",children:["I ",e.jsx("b",{children:t.UserName})," solemnly declare that to the best of my knowledge and belief, the information given above is correct and complete."]})]})},t.UserId))})]})]})]})})};export{We as default};
